# 服務層模組測試規格文檔

## 文檔資訊
- **版本**: 1.0.0
- **建立日期**: 2025-08-06
- **維護者**: 測試團隊
- **範圍**: 所有服務層 (Service Layer) 模組測試
- **來源**: 從 TEST_SPEC_HEALTH_KEYWORDS.md 分離

## 變更歷史
| 版本 | 日期 | 變更內容 | 修改者 |
|------|------|----------|--------|
| 1.0.0 | 2025-08-06 | 從 TEST_SPEC_HEALTH_KEYWORDS.md 分離服務層測試 | 測試團隊 |

## 1. 測試編號系統

### 1.1 編號格式
```
SVC-[模組]-[序號]-[類型]

範例: SVC-LD-001-UT
      SVC-PM-025-UT
```

### 1.2 服務層模組定義

| 代碼 | 模組 | 說明 | 測試數量 |
|------|------|------|----------|
| LD | Language Detection | 語言檢測服務 | 27 |
| PM | Prompt Manager | Prompt管理服務 | 29 |
| KW | Keyword Service | 關鍵字服務整合 | 10 |
| LLM | LLM Factory | LLM工廠服務 | 8 |
| **總計** | | | **74** |

### 1.3 測試類型
- **UT**: Unit Test (單元測試) - 服務層主要為單元測試
- **IT**: Integration Test (整合測試) - 服務間整合測試
- **PT**: Performance Test (效能測試) - 服務效能測試

## 2. 測試編號對照表

### 2.1 服務層測試重新編號對照

| 原編號 | 新編號 | 測試類別 | 檔案位置 |
|--------|--------|----------|----------|
| **語言檢測服務 (Language Detection)** ||||
| API-KW-211~239-UT | SVC-LD-001~027-UT | 語言檢測單元測試 | test/unit/test_language_detection.py |
| **Prompt管理服務 (Prompt Manager)** ||||
| API-KW-241~264-UT | SVC-PM-001~024-UT | Prompt管理單元測試 | test/unit/test_prompt_manager.py |
| API-KW-407~411-UT | SVC-PM-025~029-UT | Prompt管理擴展測試 | test/unit/test_prompt_manager.py |
| **關鍵字服務整合 (Keyword Service)** ||||
| API-KW-401~406,412~413,415~416-UT | SVC-KW-001~010-UT | 服務整合測試 | test/unit/test_keyword_extraction_extended.py |
| **LLM Factory服務** ||||
| SVC-LLM-501~508-UT | SVC-LLM-001~008-UT | LLM Factory單元測試 | test/unit/test_llm_factory_deployment_mapping.py |

## 3. 語言檢測服務 (SVC-LD)

### 3.1 測試概覽
- **總測試數**: 27個單元測試
- **測試檔案**: `test/unit/test_language_detection.py`
- **測試重點**: 語言識別、閾值處理、不支援語言處理

### 3.2 測試案例列表 (SVC-LD-001~027-UT)

#### SVC-LD-001-UT: 純英文內容檢測
- **名稱**: 檢測純英文文字
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證純英文內容正確識別為英文
- **測試內容**: 輸入純英文職缺描述
- **判斷標準**: 返回語言為 "en"

#### SVC-LD-002-UT: 純繁體中文檢測
- **名稱**: 檢測純繁體中文文字
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證純繁體中文內容正確識別
- **測試內容**: 輸入純繁體中文職缺描述
- **判斷標準**: 返回語言為 "zh-TW"

#### SVC-LD-003-UT: 混合語言（繁中>20%）
- **名稱**: 混合語言繁中超過20%閾值
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證混合語言閾值判斷邏輯
- **測試內容**: 輸入包含25%繁中的混合文字
- **判斷標準**: 返回語言為 "zh-TW"

#### SVC-LD-004-UT: 混合語言（繁中<20%）
- **名稱**: 混合語言繁中低於20%閾值
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證混合語言閾值判斷邏輯
- **測試內容**: 輸入包含15%繁中的混合文字
- **判斷標準**: 返回語言為 "en"

#### SVC-LD-005-UT: 邊界條件（正好20%）
- **名稱**: 繁中恰好20%的邊界測試
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證邊界條件處理
- **測試內容**: 輸入恰好20%繁中的文字
- **判斷標準**: 返回語言為 "zh-TW"（含20%）

#### SVC-LD-006~009-UT: 不支援語言拒絕
- **名稱**: 拒絕簡體中文/日文/韓文/阿拉伯文
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證不支援語言的拒絕機制
- **測試內容**: 輸入各種不支援的語言
- **判斷標準**: 拋出 UnsupportedLanguageError

#### SVC-LD-010~013-UT: 混合不支援語言處理
- **名稱**: 英文混合簡中/日文/韓文等
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證混合不支援語言的處理
- **測試內容**: 英文為主但包含不支援語言
- **判斷標準**: 根據不支援語言比例決定拒絕或接受

#### SVC-LD-014-UT: 空字串處理
- **名稱**: 空字串輸入處理
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證空輸入的錯誤處理
- **測試內容**: 輸入空字串
- **判斷標準**: 拋出適當錯誤或返回預設值

#### SVC-LD-015-UT: 純數字和符號
- **名稱**: 純數字和符號內容檢測
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證非文字內容處理
- **測試內容**: 輸入純數字和符號
- **判斷標準**: 返回預設語言或適當處理

#### SVC-LD-016-UT: HTML標籤過濾
- **名稱**: HTML內容的語言檢測
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證HTML標籤不影響語言檢測
- **測試內容**: 包含HTML標籤的文字
- **判斷標準**: 正確識別文字內容語言

#### SVC-LD-017-UT: Unicode特殊字元
- **名稱**: Unicode特殊字元處理
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證Unicode字元處理
- **測試內容**: 包含表情符號等特殊字元
- **判斷標準**: 不影響主要語言檢測

#### SVC-LD-018~019-UT: 語言組成分析
- **名稱**: 語言組成百分比計算/詳細分析
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證語言組成分析功能
- **測試內容**: 混合語言文字
- **判斷標準**: 正確返回各語言百分比

#### SVC-LD-020-UT: 快取機制測試
- **名稱**: 語言檢測結果快取
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證快取功能
- **測試內容**: 重複檢測相同文字
- **判斷標準**: 第二次檢測使用快取結果

#### SVC-LD-021-UT: 大量文字處理
- **名稱**: 處理超長文字（>10000字元）
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證大量文字處理效能
- **測試內容**: 輸入超長職缺描述
- **判斷標準**: 正確檢測且不超時

#### SVC-LD-022-UT: 字元編碼處理
- **名稱**: 不同編碼的文字處理
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證編碼處理
- **測試內容**: 各種編碼的文字
- **判斷標準**: 正確處理UTF-8等編碼

#### SVC-LD-023-UT: 語言切換點檢測
- **名稱**: 檢測文字中的語言切換
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 識別語言切換位置
- **測試內容**: 段落間語言切換的文字
- **判斷標準**: 識別主要語言和切換點

#### SVC-LD-024-UT: 專有名詞處理
- **名稱**: 技術專有名詞不影響檢測
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證專有名詞處理
- **測試內容**: 包含大量英文技術詞彙的中文文字
- **判斷標準**: 正確識別主要語言

#### SVC-LD-025-UT: 閾值可配置性
- **名稱**: 20%閾值的可配置測試
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證閾值參數化
- **測試內容**: 使用不同閾值測試
- **判斷標準**: 根據配置的閾值判斷

#### SVC-LD-026-UT: 錯誤訊息國際化
- **名稱**: 錯誤訊息語言一致性
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證錯誤訊息語言
- **測試內容**: 觸發各種錯誤
- **判斷標準**: 錯誤訊息語言符合設定

#### SVC-LD-027-UT: 效能基準測試
- **名稱**: 語言檢測效能基準
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 建立效能基準
- **測試內容**: 標準測試集
- **判斷標準**: 檢測時間 < 100ms

## 4. Prompt管理服務 (SVC-PM)

### 4.1 測試概覽
- **總測試數**: 29個單元測試
- **測試檔案**: `test/unit/test_prompt_manager.py`
- **測試重點**: Prompt選擇、版本管理、格式化、快取

### 4.2 測試案例列表 (SVC-PM-001~029-UT)

#### SVC-PM-001-UT: 英文Prompt選擇
- **名稱**: 根據語言選擇英文Prompt
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證英文語言的Prompt選擇
- **測試內容**: 輸入語言="en"
- **判斷標準**: 返回英文版Prompt

#### SVC-PM-002-UT: 繁中Prompt選擇
- **名稱**: 根據語言選擇繁中Prompt
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證繁中語言的Prompt選擇
- **測試內容**: 輸入語言="zh-TW"
- **判斷標準**: 返回繁中版Prompt

#### SVC-PM-003-UT: 預設Prompt回退
- **名稱**: 未知語言使用預設Prompt
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證預設Prompt機制
- **測試內容**: 輸入未定義的語言代碼
- **判斷標準**: 返回預設英文Prompt

#### SVC-PM-004-UT: Prompt版本管理
- **名稱**: Prompt版本號追蹤
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證版本管理功能
- **測試內容**: 取得Prompt版本資訊
- **判斷標準**: 包含正確版本號

#### SVC-PM-005-UT: 動態參數替換
- **名稱**: Prompt模板參數替換
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證參數替換功能
- **測試內容**: 提供參數進行替換
- **判斷標準**: 正確替換所有參數

#### SVC-PM-006-UT: 參數驗證
- **名稱**: 必要參數缺失檢查
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證參數完整性檢查
- **測試內容**: 缺少必要參數
- **判斷標準**: 拋出參數錯誤

#### SVC-PM-007-UT: Prompt快取機制
- **名稱**: Prompt模板快取
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證快取功能
- **測試內容**: 重複請求相同Prompt
- **判斷標準**: 使用快取版本

#### SVC-PM-008-UT: 快取失效機制
- **名稱**: Prompt更新時快取失效
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證快取更新
- **測試內容**: 更新Prompt後取得
- **判斷標準**: 返回新版本

#### SVC-PM-009-UT: 格式化功能
- **名稱**: Prompt格式化處理
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證格式化功能
- **測試內容**: 包含特殊格式的Prompt
- **判斷標準**: 正確格式化輸出

#### SVC-PM-010-UT: Markdown格式支援
- **名稱**: Markdown格式Prompt處理
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證Markdown支援
- **測試內容**: Markdown格式的Prompt
- **判斷標準**: 保持Markdown格式

#### SVC-PM-011-UT: JSON格式支援
- **名稱**: JSON格式Prompt處理
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證JSON格式支援
- **測試內容**: JSON結構的Prompt
- **判斷標準**: 正確處理JSON

#### SVC-PM-012-UT: 多段落Prompt
- **名稱**: 多段落Prompt組合
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證多段落處理
- **測試內容**: 包含多個段落的Prompt
- **判斷標準**: 正確組合所有段落

#### SVC-PM-013-UT: 條件式Prompt
- **名稱**: 條件邏輯Prompt選擇
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證條件選擇
- **測試內容**: 根據條件選擇不同部分
- **判斷標準**: 符合條件邏輯

#### SVC-PM-014-UT: Prompt繼承機制
- **名稱**: 基礎Prompt繼承
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證繼承機制
- **測試內容**: 繼承基礎Prompt
- **判斷標準**: 包含基礎和擴展內容

#### SVC-PM-015-UT: 範例注入
- **名稱**: Few-shot範例注入
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證範例注入功能
- **測試內容**: 動態注入範例
- **判斷標準**: 正確包含範例

#### SVC-PM-016-UT: Token計數
- **名稱**: Prompt Token計算
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證Token計數功能
- **測試內容**: 計算Prompt長度
- **判斷標準**: 準確的Token數

#### SVC-PM-017-UT: Token限制檢查
- **名稱**: 超過Token限制警告
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證Token限制
- **測試內容**: 超長Prompt
- **判斷標準**: 發出警告或截斷

#### SVC-PM-018-UT: 系統Prompt管理
- **名稱**: 系統級Prompt設定
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證系統Prompt
- **測試內容**: 設定系統Prompt
- **判斷標準**: 優先使用系統設定

#### SVC-PM-019-UT: 使用者Prompt覆蓋
- **名稱**: 使用者Prompt優先級
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證覆蓋機制
- **測試內容**: 使用者自定義Prompt
- **判斷標準**: 使用者設定優先

#### SVC-PM-020-UT: Prompt驗證規則
- **名稱**: Prompt格式驗證
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證格式檢查
- **測試內容**: 各種格式的Prompt
- **判斷標準**: 正確驗證格式

#### SVC-PM-021-UT: 特殊字元處理
- **名稱**: 特殊字元轉義
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證特殊字元處理
- **測試內容**: 包含特殊字元
- **判斷標準**: 正確轉義

#### SVC-PM-022-UT: 國際化支援
- **名稱**: 多語言Prompt管理
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證i18n支援
- **測試內容**: 多語言Prompt
- **判斷標準**: 支援多語言

#### SVC-PM-023-UT: Prompt載入錯誤
- **名稱**: 檔案載入錯誤處理
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證錯誤處理
- **測試內容**: 模擬載入失敗
- **判斷標準**: 優雅的錯誤處理

#### SVC-PM-024-UT: 熱重載支援
- **名稱**: Prompt熱重載
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證熱重載
- **測試內容**: 運行時更新
- **判斷標準**: 無需重啟更新

#### SVC-PM-025-UT: 批次Prompt處理
- **名稱**: 批次Prompt生成
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證批次處理
- **測試內容**: 批次生成多個Prompt
- **判斷標準**: 效率優化

#### SVC-PM-026-UT: Prompt鏈接
- **名稱**: Prompt Chain組合
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證鏈接功能
- **測試內容**: 串連多個Prompt
- **判斷標準**: 正確串連

#### SVC-PM-027-UT: 上下文注入
- **名稱**: 動態上下文注入
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證上下文功能
- **測試內容**: 注入執行時上下文
- **判斷標準**: 包含上下文資訊

#### SVC-PM-028-UT: Prompt度量
- **名稱**: Prompt使用統計
- **優先級**: P3
- **類型**: 單元測試
- **測試目標**: 驗證統計功能
- **測試內容**: 追蹤使用情況
- **判斷標準**: 準確的統計數據

#### SVC-PM-029-UT: A/B測試支援
- **名稱**: Prompt A/B測試
- **優先級**: P3
- **類型**: 單元測試
- **測試目標**: 驗證A/B測試
- **測試內容**: 隨機選擇版本
- **判斷標準**: 符合分配比例

## 5. 關鍵字服務整合 (SVC-KW)

### 5.1 測試概覽
- **總測試數**: 10個單元測試
- **測試檔案**: `test/unit/test_keyword_extraction_extended.py`
- **測試重點**: 服務整合、輸入驗證、資源管理

### 5.2 測試案例列表 (SVC-KW-001~010-UT)

#### SVC-KW-001-UT: 語言檢測與Prompt整合
- **名稱**: 語言檢測服務與Prompt管理整合
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證兩個服務的整合
- **測試內容**: 語言檢測結果傳遞給Prompt選擇
- **判斷標準**: 正確的語言對應正確的Prompt

#### SVC-KW-002-UT: 輸入前處理
- **名稱**: JD輸入預處理流程
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證輸入清理和標準化
- **測試內容**: 各種格式的輸入
- **判斷標準**: 統一的處理結果

#### SVC-KW-003-UT: 輸出後處理
- **名稱**: 關鍵字輸出後處理
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證輸出格式化
- **測試內容**: 原始LLM輸出
- **判斷標準**: 標準化的輸出格式

#### SVC-KW-004-UT: 服務降級機制
- **名稱**: 語言檢測失敗時的降級
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證容錯機制
- **測試內容**: 模擬服務失敗
- **判斷標準**: 使用預設值繼續

#### SVC-KW-005-UT: 併發請求處理
- **名稱**: 多請求併發處理
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證併發安全
- **測試內容**: 同時多個請求
- **判斷標準**: 無競態條件

#### SVC-KW-006-UT: 資源池管理
- **名稱**: 服務資源池管理
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證資源管理
- **測試內容**: 資源分配和釋放
- **判斷標準**: 無資源洩漏

#### SVC-KW-007-UT: 重試機制
- **名稱**: 服務調用重試邏輯
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證重試機制
- **測試內容**: 暫時性失敗
- **判斷標準**: 正確重試和恢復

#### SVC-KW-008-UT: 超時處理
- **名稱**: 服務調用超時
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證超時機制
- **測試內容**: 模擬超時
- **判斷標準**: 優雅的超時處理

#### SVC-KW-009-UT: 錯誤聚合
- **名稱**: 多服務錯誤聚合
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證錯誤收集
- **測試內容**: 多個服務錯誤
- **判斷標準**: 完整的錯誤報告

#### SVC-KW-010-UT: 服務健康檢查
- **名稱**: 依賴服務健康狀態
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證健康檢查
- **測試內容**: 檢查服務狀態
- **判斷標準**: 準確的健康報告

## 6. LLM Factory服務 (SVC-LLM)

### 6.1 測試概覽
- **總測試數**: 8個單元測試
- **測試檔案**: `test/unit/test_llm_factory_deployment_mapping.py`
- **測試重點**: 部署映射、模型選擇、容錯機制

### 6.2 測試案例列表 (SVC-LLM-001~008-UT)

#### SVC-LLM-001-UT: GPT-4部署映射
- **名稱**: GPT-4模型部署映射驗證
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證GPT-4映射正確性
- **測試內容**: 各種GPT-4模型名稱
- **判斷標準**: 映射到正確的Azure部署

#### SVC-LLM-002-UT: GPT-3.5部署映射
- **名稱**: GPT-3.5模型部署映射驗證
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證GPT-3.5映射
- **測試內容**: GPT-3.5變體
- **判斷標準**: 正確的部署名稱

#### SVC-LLM-003-UT: 未知模型處理
- **名稱**: 未知模型名稱處理
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證錯誤處理
- **測試內容**: 不存在的模型名稱
- **判斷標準**: 適當的錯誤或預設值

#### SVC-LLM-004-UT: 區域選擇邏輯
- **名稱**: Azure區域選擇
- **優先級**: P1
- **類型**: 單元測試
- **測試目標**: 驗證區域選擇
- **測試內容**: 不同區域配置
- **判斷標準**: 選擇最佳區域

#### SVC-LLM-005-UT: 容錯回退機制
- **名稱**: 主模型失敗時的回退
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證回退機制
- **測試內容**: 模擬主模型失敗
- **判斷標準**: 自動切換到備用模型

#### SVC-LLM-006-UT: 配置載入
- **名稱**: 部署配置載入
- **優先級**: P0
- **類型**: 單元測試
- **測試目標**: 驗證配置載入
- **測試內容**: 各種配置格式
- **判斷標準**: 正確解析配置

#### SVC-LLM-007-UT: 動態模型切換
- **名稱**: 運行時模型切換
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證動態切換
- **測試內容**: 運行時改變模型
- **判斷標準**: 無縫切換

#### SVC-LLM-008-UT: 模型能力查詢
- **名稱**: 查詢模型支援的功能
- **優先級**: P2
- **類型**: 單元測試
- **測試目標**: 驗證能力查詢
- **測試內容**: 查詢各模型能力
- **判斷標準**: 返回正確的能力清單

## 7. 測試執行指南

### 7.1 單獨執行各模組測試

```bash
# 語言檢測服務測試
pytest test/unit/test_language_detection.py -v

# Prompt管理服務測試
pytest test/unit/test_prompt_manager.py -v

# 關鍵字服務整合測試
pytest test/unit/test_keyword_extraction_extended.py -v

# LLM Factory服務測試
pytest test/unit/test_llm_factory_deployment_mapping.py -v
```

### 7.2 執行所有服務層測試

```bash
# 執行所有SVC層測試
pytest test/unit/test_language_detection.py \
       test/unit/test_prompt_manager.py \
       test/unit/test_keyword_extraction_extended.py \
       test/unit/test_llm_factory_deployment_mapping.py -v

# 或使用標記（如果有設定）
pytest -m "service_layer" -v
```

### 7.3 測試覆蓋率報告

```bash
# 生成服務層測試覆蓋率
pytest test/unit/test_language_detection.py \
       test/unit/test_prompt_manager.py \
       test/unit/test_keyword_extraction_extended.py \
       test/unit/test_llm_factory_deployment_mapping.py \
       --cov=src/services --cov-report=html
```

## 8. 測試統計

### 8.1 按模組統計

| 模組 | 測試數量 | 優先級分佈 | 狀態 |
|------|----------|------------|------|
| 語言檢測 (LD) | 27 | P0:13, P1:9, P2:5 | ✅ 完成 |
| Prompt管理 (PM) | 29 | P0:7, P1:13, P2:7, P3:2 | ✅ 完成 |
| 關鍵字服務 (KW) | 10 | P0:3, P1:5, P2:2 | ✅ 完成 |
| LLM Factory (LLM) | 8 | P0:5, P1:1, P2:2 | ✅ 完成 |
| **總計** | **74** | P0:28, P1:28, P2:16, P3:2 | ✅ 完成 |

### 8.2 測試優先級分佈

| 優先級 | 數量 | 百分比 | 說明 |
|--------|------|--------|------|
| P0 | 28 | 37.8% | 核心功能，必須通過 |
| P1 | 28 | 37.8% | 重要功能，應該通過 |
| P2 | 16 | 21.6% | 次要功能，建議通過 |
| P3 | 2 | 2.7% | 選擇性功能 |

### 8.3 測試類型分佈

| 類型 | 數量 | 百分比 | 說明 |
|------|------|--------|------|
| 單元測試 (UT) | 74 | 100% | 服務層主要為單元測試 |
| 整合測試 (IT) | 0 | 0% | 整合測試在API層 |
| 效能測試 (PT) | 0 | 0% | 效能測試在API層 |

## 9. 維護指南

### 9.1 新增測試規範
1. 遵循 SVC-[模組]-[序號]-[類型] 編號格式
2. 序號從現有最大值+1開始
3. 更新對應的測試檔案
4. 更新本文檔的統計資料

### 9.2 測試遷移計畫
- 從原始 API-KW-* 編號遷移到 SVC-* 編號
- 更新測試檔案中的測試ID註解
- 保持向後相容性追蹤

### 9.3 持續改進
- 定期審查測試覆蓋率
- 根據生產問題新增測試案例
- 優化測試執行時間

---

**文檔維護**:
- 版本控制：使用語意化版本號
- 更新頻率：每個Sprint結束時審查
- 負責團隊：測試團隊與開發團隊共同維護