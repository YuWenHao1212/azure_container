# Azure Container Apps Environment Configuration Template
# Copy this to .env and fill in your actual values

# Application Settings
ENVIRONMENT=production
LOG_LEVEL=INFO
DEBUG=false

# Language Detection Settings
USE_RULE_BASED_DETECTOR=true  # Thread-safe rule-based language detection (recommended)

# Monitoring Configuration
MONITORING_ENABLED=false
LIGHTWEIGHT_MONITORING=true
ERROR_CAPTURE_ENABLED=true

# Monitoring Log File Configuration (Local Development)
# Set MONITORING_LOG_FILE for local development to write logs to file
# Leave empty for Azure Container Apps (auto-collects stdout)
MONITORING_LOG_FILE=logs/monitoring.log  # Local development: enables file logging
# MONITORING_LOG_FILE=                    # Azure production: disable for auto-collect
MONITORING_LOG_MAX_SIZE_MB=10             # Max file size before rotation
MONITORING_LOG_BACKUP_COUNT=5             # Number of backup files to keep

# Azure OpenAI Configuration - Japan East Region
# All models are deployed in Japan East and share the same API key
AZURE_OPENAI_ENDPOINT=https://airesumeadvisor.openai.azure.com
AZURE_OPENAI_API_KEY=your-shared-api-key  # This key works for all models
AZURE_OPENAI_API_VERSION=2025-01-01-preview

# Model Deployments (all in Japan East)
AZURE_OPENAI_GPT4_DEPLOYMENT=gpt-4.1-japan              # Main GPT-4.1 model
GPT41_MINI_JAPANEAST_DEPLOYMENT=gpt-4-1-mini-japaneast  # GPT-4.1 Mini for fast operations

# GPT-4.1 Mini Configuration (uses same endpoint and key)
GPT41_MINI_JAPANEAST_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
GPT41_MINI_JAPANEAST_API_KEY=${AZURE_OPENAI_API_KEY}
GPT41_MINI_JAPANEAST_API_VERSION=${AZURE_OPENAI_API_VERSION}

# Embedding Services (all in Japan East, use same API key)
EMBEDDING_ENDPOINT=https://airesumeadvisor.openai.azure.com/openai/deployments/embedding-3-large-japan/embeddings?api-version=2023-05-15
EMBEDDING_API_KEY=${AZURE_OPENAI_API_KEY}

# Course Embedding Service (specialized for course search)
COURSE_EMBEDDING_ENDPOINT=https://airesumeadvisor.openai.azure.com/openai/deployments/embedding-3-small-japan/embeddings?api-version=2023-05-15
COURSE_EMBEDDING_API_KEY=${AZURE_OPENAI_API_KEY}

# LLM Model Selection (Override per API endpoint)
# Values: "gpt-4.1" (maps to gpt-4.1-japan) or "gpt-4.1-mini"
LLM_MODEL_KEYWORDS=gpt-4.1-mini     # Fast keyword extraction
LLM_MODEL_GAP_ANALYSIS=gpt-4.1    # Detailed analysis

# Prompt Version Configuration
GAP_ANALYSIS_PROMPT_VERSION=2.1.8   # Gap Analysis prompt version (default: uses active version)
LLM_MODEL_RESUME_FORMAT=gpt-4.1   # Quality formatting
LLM_MODEL_RESUME_TAILOR=gpt-4.1   # Customization

# Resume Tailoring Debug Mode
LLM2_DEBUG_MODE=false              # Set to 'true' to enable diagnostic messages for LLM2 fallback

# Embedding model selection (optional - defaults will be used if not set)
LLM_MODEL_EMBEDDING_DEFAULT=embedding-3-large   # Default embedding model
LLM_MODEL_COURSE_EMBEDDING=embedding-3-small    # Course search embedding

# Security
JWT_SECRET_KEY=your-jwt-secret-key-change-this-in-production
CONTAINER_APP_API_KEY=your-container-app-api-key

# CORS Configuration
CORS_ORIGINS=https://airesumeadvisor.com,https://airesumeadvisor.bubbleapps.io,https://www.airesumeadvisor.com

# Database (if using PostgreSQL for course search)
# DATABASE_URL=postgresql://user:password@host:port/database

# PostgreSQL Configuration for Course Search (REQUIRED for Gap Analysis)
# Gap Analysis API uses Course Availability Check which needs PostgreSQL
# For production deployment, these MUST be set in Azure Container Apps
POSTGRES_HOST=airesumeadvisor-courses-db-eastasia.postgres.database.azure.com
POSTGRES_DATABASE=coursesdb
POSTGRES_USER=coursesadmin
POSTGRES_PASSWORD=your-password-here  # Use Azure Key Vault in production
POSTGRES_SSL_MODE=require

# Resume Structure Analysis Configuration
ENABLE_RESUME_STRUCTURE_ANALYSIS=true
STRUCTURE_ANALYSIS_TIMEOUT=5.0
RESUME_STRUCTURE_PROMPT_VERSION=v1.0.1  # Prompt version for resume structure analyzer
STRUCTURE_ANALYSIS_MAX_RETRIES=3
STRUCTURE_ANALYSIS_RETRY_DELAY=0.5

# Course Availability Cache Configuration
ENABLE_COURSE_CACHE=true  # Set to 'false' to disable cache and use direct DB queries

# Application Insights (optional)
# APPINSIGHTS_CONNECTION_STRING=your-application-insights-connection-string

# =============================================================================
# Gap Analysis & Course Availability Configuration
# =============================================================================

# Gap Analysis Prompt Configuration
GAP_ANALYSIS_PROMPT_VERSION=latest  # Options: latest, 2.1.7, 2.1.8, or specific version
GAP_ANALYSIS_TEMPERATURE=0.3        # LLM temperature for gap analysis (0.0-1.0)
GAP_ANALYSIS_MAX_TOKENS=6000        # Maximum tokens for gap analysis response

# Course Availability Similarity Thresholds
# These control how strict the course matching is
COURSE_THRESHOLD_SKILL=0.35         # Similarity threshold for SKILL category (target: 0.40)
COURSE_THRESHOLD_FIELD=0.30         # Similarity threshold for FIELD category (target: 0.35)
COURSE_THRESHOLD_DEFAULT=0.35       # Similarity threshold for DEFAULT category (target: 0.40)
COURSE_MIN_THRESHOLD=0.30           # Minimum threshold for initial filtering (target: 0.35)

# Course Availability Features
ENABLE_DEFICIT_FILLING=true         # Enable intelligent quota management and deficit filling
ENABLE_COURSE_CACHE=true            # Enable dynamic course caching (30min TTL)

# Index Calculation Configuration
INDEX_CALC_CACHE_MAX_SIZE=1000      # Maximum cache size for index calculation

# Resource Pool Configuration (for Combined Analysis)
RESOURCE_POOL_ENABLED=true          # Enable resource pooling for parallel processing
RESOURCE_POOL_MIN_SIZE=2            # Minimum number of resources in pool
RESOURCE_POOL_MAX_SIZE=10           # Maximum number of resources in pool
RESOURCE_POOL_IDLE_TIMEOUT=300      # Idle timeout in seconds before resource cleanup

# Retry & Error Handling Configuration
ADAPTIVE_RETRY_ENABLED=true         # Enable adaptive retry strategy
MAX_RETRY_DELAY_SECONDS=20          # Maximum delay between retries
ENABLE_PARTIAL_RESULTS=false        # Return partial results on failure

# Performance Optimization
USE_V2_IMPLEMENTATION=true          # Use optimized v2 implementation (recommended)