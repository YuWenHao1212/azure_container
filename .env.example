# 🔧 Azure Container API - 環境變數完整配置
# ============================================
# 將此檔案複製為 .env 並填入實際的值
# 
# 📚 相關文檔：
# - 環境管理指南: docs/ENVIRONMENT-AND-PROMPT-MANAGEMENT.md
# - 部署配置: CLAUDE-appendix/environments.md
# - 安全最佳實踐: docs/security.md
# ============================================

# ===== 基本應用程式設定 =====
ENVIRONMENT=production               # 環境: development | staging | production
LOG_LEVEL=INFO                      # 日誌級別: DEBUG | INFO | WARNING | ERROR
DEBUG=false                         # 除錯模式 (生產環境請設為 false)

# ===== 語言檢測設定 =====
USE_RULE_BASED_DETECTOR=true       # 使用執行緒安全的規則型語言檢測 (推薦)

# ===== 監控配置 =====
MONITORING_ENABLED=false            # 完整監控 (生產環境建議關閉)
LIGHTWEIGHT_MONITORING=true         # 輕量級監控 (推薦保持開啟)
ERROR_CAPTURE_ENABLED=true          # 錯誤捕獲

# 監控日誌檔案配置 (本地開發用)
# Azure Container Apps 會自動收集 stdout，生產環境請留空
MONITORING_LOG_FILE=logs/monitoring.log  # 本地開發: 啟用檔案日誌
# MONITORING_LOG_FILE=                   # Azure 生產: 留空以自動收集
MONITORING_LOG_MAX_SIZE_MB=10           # 日誌檔案最大大小 (MB)
MONITORING_LOG_BACKUP_COUNT=5           # 保留的備份檔案數量

# ===== Azure OpenAI 配置 - Japan East Region =====
# 所有模型都部署在 Japan East，使用共同的 API Key
AZURE_OPENAI_ENDPOINT=https://airesumeadvisor.openai.azure.com
AZURE_OPENAI_API_KEY=your-shared-api-key  # 共用的 API Key (所有模型通用)
AZURE_OPENAI_API_VERSION=2025-01-01-preview

# 模型部署名稱 (都在 Japan East)
AZURE_OPENAI_GPT4_DEPLOYMENT=gpt-4.1-japan              # 主要 GPT-4.1 模型
GPT41_MINI_JAPANEAST_DEPLOYMENT=gpt-4-1-mini-japaneast  # 高效能 GPT-4.1 Mini

# GPT-4.1 Mini 配置 (使用相同的 endpoint 和 key)
GPT41_MINI_JAPANEAST_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
GPT41_MINI_JAPANEAST_API_KEY=${AZURE_OPENAI_API_KEY}
GPT41_MINI_JAPANEAST_API_VERSION=${AZURE_OPENAI_API_VERSION}

# Embedding 服務 (都在 Japan East，共用 API Key)
EMBEDDING_ENDPOINT=https://airesumeadvisor.openai.azure.com/openai/deployments/embedding-3-large-japan/embeddings?api-version=2023-05-15
EMBEDDING_API_KEY=${AZURE_OPENAI_API_KEY}

# 課程 Embedding (課程搜尋專用)
COURSE_EMBEDDING_ENDPOINT=https://airesumeadvisor.openai.azure.com/openai/deployments/embedding-3-small-japan/embeddings?api-version=2023-05-15
COURSE_EMBEDDING_API_KEY=${AZURE_OPENAI_API_KEY}

# ===== LLM 模型選擇 (可針對不同 API 端點覆寫) =====
# 值: "gpt-4.1" (映射到 gpt-4.1-japan) 或 "gpt-4.1-mini"
LLM_MODEL_KEYWORDS=gpt-4.1-mini     # 快速關鍵字提取
LLM_MODEL_GAP_ANALYSIS=gpt-4.1      # 詳細差距分析
LLM_MODEL_RESUME_FORMAT=gpt-4.1     # 高品質格式化
LLM_MODEL_RESUME_TAILOR=gpt-4.1     # 履歷客製化

# ===== Prompt 版本配置 =====
GAP_ANALYSIS_PROMPT_VERSION=2.1.8   # Gap Analysis prompt 版本
RESUME_STRUCTURE_PROMPT_VERSION=v1.0.1  # Resume Structure Analyzer prompt 版本

# ===== 履歷客製化除錯模式 =====
LLM2_DEBUG_MODE=false               # 設為 'true' 啟用 LLM2 後備診斷訊息

# ===== 安全設定 =====
JWT_SECRET_KEY=your-jwt-secret-key-change-this-in-production  # JWT 簽名密鑰
CONTAINER_APP_API_KEY=your-container-app-api-key             # API 認證密鑰

# ===== CORS 配置 =====
CORS_ORIGINS=https://airesumeadvisor.com,https://airesumeadvisor.bubbleapps.io,https://www.airesumeadvisor.com

# ===== PostgreSQL 配置 (課程搜尋必需) =====
# Gap Analysis API 使用課程可用性檢查，需要 PostgreSQL
# 生產部署時，這些必須在 Azure Container Apps 中設定
POSTGRES_HOST=airesumeadvisor-courses-db-eastasia.postgres.database.azure.com
POSTGRES_DATABASE=coursesdb
POSTGRES_USER=coursesadmin
POSTGRES_PASSWORD=your-password-here  # 生產環境請使用 Azure Key Vault
POSTGRES_SSL_MODE=require

# ===== 履歷結構分析配置 =====
ENABLE_RESUME_STRUCTURE_ANALYSIS=true  # 啟用履歷結構分析
STRUCTURE_ANALYSIS_TIMEOUT=5.0         # 分析超時時間 (秒)
STRUCTURE_ANALYSIS_MAX_RETRIES=3       # 最大重試次數
STRUCTURE_ANALYSIS_RETRY_DELAY=0.5     # 重試延遲 (秒)

# ===== Gap Analysis & 課程可用性配置 =====
# Gap Analysis Prompt 配置
GAP_ANALYSIS_TEMPERATURE=0.3        # LLM 溫度 (0.0-1.0)
GAP_ANALYSIS_MAX_TOKENS=6000        # 最大回應 tokens

# 課程可用性相似度閾值
# 控制課程匹配的嚴格程度
COURSE_THRESHOLD_SKILL=0.35         # SKILL 類別相似度閾值 (目標: 0.40)
COURSE_THRESHOLD_FIELD=0.30         # FIELD 類別相似度閾值 (目標: 0.35)
COURSE_THRESHOLD_DEFAULT=0.35       # DEFAULT 類別相似度閾值 (目標: 0.40)
COURSE_MIN_THRESHOLD=0.30           # 初始過濾最小閾值 (目標: 0.35)

# 課程可用性功能
ENABLE_DEFICIT_FILLING=true         # 啟用智能配額管理和缺額填充
ENABLE_COURSE_CACHE=true            # 啟用動態課程快取 (30分鐘 TTL)

# ===== 資源池配置 (組合分析用) =====
RESOURCE_POOL_ENABLED=true          # 啟用資源池進行並行處理
RESOURCE_POOL_MIN_SIZE=2            # 池中最少資源數
RESOURCE_POOL_MAX_SIZE=10           # 池中最多資源數
RESOURCE_POOL_IDLE_TIMEOUT=300      # 閒置超時清理時間 (秒)

# ===== 重試與錯誤處理配置 =====
ADAPTIVE_RETRY_ENABLED=true         # 啟用自適應重試策略
MAX_RETRY_DELAY_SECONDS=20          # 重試間最大延遲
ENABLE_PARTIAL_RESULTS=false        # 失敗時返回部分結果

# ===== 效能優化 =====
USE_V2_IMPLEMENTATION=true          # 使用優化的 v2 實作 (推薦)
INDEX_CALC_CACHE_MAX_SIZE=1000      # Index Calculation 快取最大大小

# ===== Application Insights (選用) =====
# APPINSIGHTS_CONNECTION_STRING=your-application-insights-connection-string