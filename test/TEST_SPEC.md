# Azure Container API 測試規格文檔

## 文檔資訊
- **版本**: 1.0.1
- **建立日期**: 2025-07-30
- **最後更新**: 2025-07-30
- **維護者**: 測試團隊

## 變更歷史
| 版本 | 日期 | 變更內容 | 修改者 |
|------|------|----------|--------|
| 1.0.0 | 2025-07-30 | 初始版本 | 測試團隊 |
| 1.0.1 | 2025-07-30 | 修正格式問題 | 測試團隊 |

## 1. 測試案例編號系統

### 1.1 編號格式
```
[類別]-[模組]-[序號]-[類型]

範例: API-KW-001-UT
```

### 1.2 編號說明
| 代碼 | 類別 | 說明 | 編號範圍 |
|------|------|------|----------|
| **類別** |
| API | API 端點 | API 相關測試 | - |
| SVC | Service | 服務層測試 | - |
| UTL | Utility | 工具函數測試 | - |
| INT | Integration | 整合測試 | - |
| **模組** |
| HLT | Health | 健康檢查 | 001-099 |
| KW | Keywords | 關鍵字提取 | 100-199 |
| IDX | Index | 匹配指數 | 200-299 |
| GAP | Gap Analysis | 差距分析 | 300-399 |
| FMT | Format | 履歷格式化 | 400-499 |
| TLR | Tailor | 履歷客製化 | 500-599 |
| CRS | Course | 課程搜尋 | 600-699 |
| AUTH | Auth | 認證授權 | 700-799 |
| MON | Monitor | 監控除錯 | 800-899 |
| - | Reserved | 預留擴充 | 900-999 |
| **類型** |
| UT | Unit Test | 單元測試 | - |
| IT | Integration | 整合測試 | - |
| PT | Performance | 效能測試 | - |
| ST | Security | 安全測試 | - |

## 2. 測試案例模板

### 2.1 基本資訊

測試案例應包含以下資訊：

**標題格式**：`## 測試案例: [編號]`

**必要欄位**：
- 名稱：測試案例名稱
- 優先級：P0/P1/P2
- 類型：單元/整合/效能/安全
- 需求編號：REQ-XXX (對應需求文檔)
- 建立日期：YYYY-MM-DD
- 最後更新：YYYY-MM-DD

**測試內容**：
- 測試目標：簡述此測試要驗證的功能或情境
- 前置條件：列出所有必要的環境或資料準備
- 測試資料：輸入資料和預期輸出（YAML 格式）
- 測試步驟：詳細的執行步驟
- 預期結果：具體的驗證點
- 實際結果：執行後填寫
- 備註：任何額外說明

### 2.2 測試資料範例

```yaml
input:
  key1: value1
  key2: value2
expected:
  status: 200
  response: 
    success: true
    data: {...}
```

## 3. 現有測試案例

### 3.1 健康檢查模組 (HLT)

#### API-HLT-001-UT: 基本健康檢查
- **名稱**: 健康檢查端點正常回應
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證 /health 端點返回正確狀態

#### API-HLT-002-IT: 健康檢查整合測試
- **名稱**: 健康檢查含依賴服務狀態
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-001
- **測試目標**: 驗證健康檢查能正確反映外部服務狀態

### 3.2 關鍵字提取模組 (KW)

#### API-KW-101-UT: 基本關鍵字提取
- **名稱**: JD 關鍵字提取正常流程
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證能從職缺描述提取技能關鍵字

#### API-KW-102-UT: 空輸入處理
- **名稱**: 空 JD 輸入錯誤處理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證空輸入返回適當錯誤

#### API-KW-103-UT: 超長輸入處理
- **名稱**: 超過長度限制的 JD 處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證超長輸入的截斷處理

#### API-KW-104-IT: Azure OpenAI 整合
- **名稱**: 關鍵字提取 API 整合測試
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: 驗證與 Azure OpenAI 的整合

#### API-KW-105-PT: 關鍵字提取效能
- **名稱**: 關鍵字提取回應時間測試
- **優先級**: P1
- **類型**: 效能測試
- **需求編號**: REQ-002
- **測試目標**: 驗證回應時間 < 3秒

## 4. 測試追溯性設計

### 4.1 需求對應表
| 需求編號 | 需求描述 | 相關測試案例 |
|----------|----------|-------------|
| REQ-001 | 系統健康監控 | API-HLT-001-UT, API-HLT-002-IT |
| REQ-002 | JD 關鍵字提取 | API-KW-101~105 |
| REQ-003 | 履歷匹配指數 | API-IDX-201~205 (預留) |
| REQ-004 | 差距分析 | API-GAP-301~305 (預留) |

### 4.2 覆蓋率矩陣
| 功能模組 | 單元測試 | 整合測試 | 效能測試 | 安全測試 |
|----------|----------|----------|----------|----------|
| 健康檢查 | ✅ | ✅ | - | - |
| 關鍵字提取 | ✅ | ✅ | ✅ | ⏳ |
| 匹配指數 | ⏳ | ⏳ | ⏳ | ⏳ |
| 差距分析 | ⏳ | ⏳ | ⏳ | ⏳ |

**圖例**: ✅ 已完成 | ⏳ 計劃中 | - 不適用

## 5. 測試資料規範

### 5.1 資料分類

測試資料目錄結構：

```
fixtures/
├── jd/                 # 職缺描述範例
│   ├── valid/         # 有效輸入
│   ├── invalid/       # 無效輸入
│   └── edge_cases/    # 邊界案例
├── resumes/           # 履歷範例
├── responses/         # API 回應範例
└── configs/           # 測試配置
```

### 5.2 命名規範
- 有效資料: `valid_[描述]_[序號].json`
- 無效資料: `invalid_[錯誤類型]_[序號].json`
- 邊界案例: `edge_[案例類型]_[序號].json`

## 6. 測試執行規範

### 6.1 執行指令

```bash
# Level 0: Prompt 驗證
./scripts/run_level0_tests.sh

# Level 1: 程式碼品質
./run_level1_tests.sh

# Level 2: 單元測試
python run_level2_tests.py

# 特定模組測試
pytest tests/unit/test_keyword_extraction.py -v

# 指定測試案例
pytest tests/unit/test_keyword_extraction.py::test_API_KW_101_UT -v
```

### 6.2 測試標記 (Markers)

```python
@pytest.mark.unit          # 單元測試
@pytest.mark.integration   # 整合測試
@pytest.mark.performance   # 效能測試
@pytest.mark.security      # 安全測試
@pytest.mark.p0           # P0 優先級
@pytest.mark.p1           # P1 優先級
@pytest.mark.p2           # P2 優先級
```

## 7. 擴充指南

### 7.1 新增測試案例
1. 選擇適當的模組代碼
2. 使用下一個可用序號
3. 遵循命名規範
4. 更新追溯矩陣
5. 實作測試程式碼

### 7.2 新增功能模組
1. 在編號系統中定義新模組代碼
2. 分配序號範圍 (預留充足空間)
3. 建立對應的測試檔案
4. 更新測試矩陣

## 8. 最佳實踐

### 8.1 測試設計原則
- **獨立性**: 每個測試可獨立執行
- **重複性**: 多次執行結果一致
- **快速性**: 單元測試 < 100ms
- **清晰性**: 測試名稱即文檔

### 8.2 程式碼規範

```python
# 測試函數命名
def test_[測試編號]_[簡短描述]():
    """測試案例: [編號] - [完整描述]"""
    # Arrange
    # Act  
    # Assert

# 測試類別組織
class Test[模組名稱]:
    """[模組]相關測試"""
    
    @pytest.fixture
    def setup_data(self):
        """測試資料準備"""
        pass
```

---

**注意事項**:
- 測試編號一旦分配不可更改
- 刪除的測試案例編號不可重用
- 定期審查並更新測試規格