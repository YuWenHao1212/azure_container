# Azure Container API 測試規格文檔

## 文檔資訊
- **版本**: 2.1.0
- **建立日期**: 2025-07-30
- **最後更新**: 2025-07-31
- **維護者**: 測試團隊

## 變更歷史
| 版本 | 日期 | 變更內容 | 修改者 |
|------|------|----------|--------|
| 1.0.0 | 2025-07-30 | 初始版本 | 測試團隊 |
| 1.0.1 | 2025-07-30 | 修正格式問題 | 測試團隊 |
| 2.0.0 | 2025-07-31 | 完整整合所有測試案例規格（91個測試案例） | 測試團隊 |
| 2.1.0 | 2025-07-31 | 更新整合測試狀態，標記健康檢查和 Azure OpenAI 整合測試為已完成 | 測試團隊 |

## 1. 測試案例編號系統

### 1.1 編號格式
```
[類別]-[模組]-[序號]-[類型]

範例: API-KW-001-UT
```

### 1.2 編號說明
| 代碼 | 類別 | 說明 | 編號範圍 |
|------|------|------|----------|
| **類別** |
| API | API 端點 | API 相關測試 | - |
| SVC | Service | 服務層測試 | - |
| UTL | Utility | 工具函數測試 | - |
| INT | Integration | 整合測試 | - |
| **模組** |
| HLT | Health | 健康檢查 | 001-099 |
| KW | Keywords | 關鍵字提取 | 100-199 |
| IDX | Index | 匹配指數 | 200-299 |
| GAP | Gap Analysis | 差距分析 | 300-399 |
| FMT | Format | 履歷格式化 | 400-499 |
| TLR | Tailor | 履歷客製化 | 500-599 |
| CRS | Course | 課程搜尋 | 600-699 |
| AUTH | Auth | 認證授權 | 700-799 |
| MON | Monitor | 監控除錯 | 800-899 |
| - | Reserved | 預留擴充 | 900-999 |
| **類型** |
| UT | Unit Test | 單元測試 | - |
| IT | Integration | 整合測試 | - |
| PT | Performance | 效能測試 | - |
| ST | Security | 安全測試 | - |

## 2. 測試案例模板

### 2.1 基本資訊

測試案例應包含以下資訊：

**標題格式**：`## 測試案例: [編號]`

**必要欄位**：
- 名稱：測試案例名稱
- 優先級：P0/P1/P2
- 類型：單元/整合/效能/安全
- 需求編號：REQ-XXX (對應需求文檔)
- 建立日期：YYYY-MM-DD
- 最後更新：YYYY-MM-DD

**測試內容**：
- 測試目標：簡述此測試要驗證的功能或情境
- 前置條件：列出所有必要的環境或資料準備
- 測試資料：輸入資料和預期輸出（YAML 格式）
- 測試步驟：詳細的執行步驟
- 預期結果：具體的驗證點
- 實際結果：執行後填寫
- 備註：任何額外說明

### 2.2 測試資料範例

```yaml
input:
  key1: value1
  key2: value2
expected:
  status: 200
  response: 
    success: true
    data: {...}
```

## 3. 現有測試案例

### 3.1 健康檢查模組 (HLT) - 10個測試案例

#### API-HLT-001-UT: 基本健康檢查
- **名稱**: 健康檢查端點正常回應
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證 /health 端點返回正確狀態

#### API-HLT-002-UT: 回應格式驗證
- **名稱**: 健康檢查回應格式正確性
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證回應包含所有必要欄位（status, timestamp, version, environment）

#### API-HLT-003-UT: 版本資訊正確性
- **名稱**: 健康檢查版本與設定一致
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證版本號與 settings.VERSION 一致

#### API-HLT-004-UT: 總是回傳健康狀態
- **名稱**: 健康檢查總是返回 healthy 狀態
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證無論系統狀態如何都返回 healthy

#### API-HLT-005-UT: 時間戳記格式驗證
- **名稱**: 健康檢查時間戳記為 ISO 格式
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證 timestamp 符合 ISO 8601 格式

#### API-HLT-006-UT: HTTP 方法驗證
- **名稱**: 健康檢查只接受 GET 方法
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證非 GET 方法返回 405 Method Not Allowed

#### API-HLT-007-UT: 不需要認證
- **名稱**: 健康檢查不需要認證
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證不帶認證資訊也能正常訪問

#### API-HLT-008-UT: CORS headers 存在
- **名稱**: 健康檢查包含 CORS headers
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證回應包含適當的 CORS headers

#### API-HLT-009-UT: Mock 時間戳記測試
- **名稱**: 健康檢查時間戳記可 Mock
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-001
- **測試目標**: 驗證時間戳記可被 Mock 以利測試

#### API-HLT-010-IT: 健康檢查整合測試 【已實作】
- **名稱**: 健康檢查含依賴服務狀態
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-001
- **測試目標**: 驗證健康檢查能正確反映外部服務狀態
- **狀態**: ✅ 已實作

### 3.2 關鍵字提取模組 (KW) - 基礎功能測試 (11個)

#### API-KW-101-UT: 基本關鍵字提取
- **名稱**: JD 關鍵字提取正常流程
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證能從職缺描述提取技能關鍵字

#### API-KW-102-UT: 驗證錯誤處理（描述過短）
- **名稱**: 短 JD 輸入錯誤處理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證少於 200 字元的輸入返回適當錯誤

#### API-KW-103-UT: 無效的 max_keywords 參數
- **名稱**: 無效 max_keywords 參數處理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證 max_keywords < 1 或 > 50 時返回錯誤

#### API-KW-104-UT: Azure OpenAI 速率限制錯誤處理
- **名稱**: 處理 Azure OpenAI 速率限制
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證速率限制錯誤返回適當的 503 錯誤

#### API-KW-105-UT: 逾時錯誤處理
- **名稱**: 處理 API 逾時
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證逾時返回 504 Gateway Timeout

#### API-KW-106-UT: 品質警告偵測
- **名稱**: 關鍵字品質警告
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證低品質關鍵字時返回警告訊息

#### API-KW-107-UT: 回應格式驗證
- **名稱**: 關鍵字提取回應格式
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證回應包含所有必要欄位

#### API-KW-108-UT: 中文職缺描述支援
- **名稱**: 支援繁體中文 JD
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證繁體中文 JD 能正確處理

#### API-KW-109-UT: 錯誤時的服務清理
- **名稱**: 服務清理機制
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證錯誤發生時正確清理服務資源

#### API-KW-110-UT: 長職缺描述的邊界案例
- **名稱**: 處理超長 JD
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證 8000 字元 JD 的處理

#### API-KW-111-IT: Azure OpenAI 整合 【已實作】
- **名稱**: 關鍵字提取 API 整合測試
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: 驗證與 Azure OpenAI 的整合
- **狀態**: ✅ 已實作

### 3.3 語言檢測功能測試 (26個單元測試)

#### API-KW-211-UT: 純英文語言檢測
- **名稱**: 驗證純英文內容正確檢測為 "en"
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 確保英文 JD 被正確識別並選擇英文 prompt

#### API-KW-212-UT: 純繁體中文語言檢測
- **名稱**: 驗證純繁體中文內容正確檢測為 "zh-TW"
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: language="zh-TW", confidence >= 0.5

#### API-KW-213-UT: 中英混合（繁中>20%）
- **名稱**: 混合語言繁中超過 20% 時檢測為 zh-TW
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證 20% 繁體中文閾值規則正確執行

#### API-KW-214-UT: 中英混合（繁中<20%）
- **名稱**: 混合語言繁中少於 20% 時檢測為 en
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證混合內容中繁中少於 20% 時檢測為 en

#### API-KW-215-UT: 正好 20% 繁中閾值測試
- **名稱**: 驗證邊界條件（正好 20% 繁中）
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: language="zh-TW"（含邊界）

#### API-KW-216-UT: 拒絕簡體中文
- **名稱**: 簡體中文被正確拒絕
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 返回 HTTP 400 + UNSUPPORTED_LANGUAGE 錯誤

#### API-KW-217-UT: 拒絕日文
- **名稱**: 日文被正確拒絕
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 返回 HTTP 400 + UNSUPPORTED_LANGUAGE 錯誤

#### API-KW-218-UT: 拒絕韓文
- **名稱**: 韓文被正確拒絕
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 返回 HTTP 400 + UNSUPPORTED_LANGUAGE 錯誤

#### API-KW-219-UT: 拒絕西班牙文
- **名稱**: 西班牙文被正確拒絕
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 返回 HTTP 400 + UNSUPPORTED_LANGUAGE 錯誤

#### API-KW-220-UT: 拒絕混合不支援語言
- **名稱**: 混合多種不支援語言被正確拒絕
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 返回 HTTP 400 + UNSUPPORTED_LANGUAGE 錯誤

#### API-KW-221-UT: 文字過短錯誤
- **名稱**: 文字長度不足時的錯誤處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: ValueError, "Text too short for reliable detection"

#### API-KW-222-UT: 空白文字錯誤
- **名稱**: 空白或純空格文字的錯誤處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: ValueError, "Empty or whitespace-only text"

#### API-KW-223-UT: 低信心度檢測
- **名稱**: 低信心度語言檢測的處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 回傳預設語言 "en" 並標記低信心度

#### API-KW-224-UT: 語言組成分析
- **名稱**: 內部語言組成分析邏輯
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: analyze_language_mix() 方法正確計算各語言比例

#### API-KW-225-UT: 日文中文字符處理
- **名稱**: 日文中包含中文字符的檢測
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 正確識別為日文而非中文

#### API-KW-226-UT: 模糊情況優先繁中
- **名稱**: 模糊情況下優先選擇繁體中文
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 在不確定情況下優先返回 zh-TW

#### API-KW-227-UT: 精確20%閾值測試
- **名稱**: 正好 20% 繁中的精確測試
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證邊界條件處理正確

#### API-KW-228-UT: 低於20%閾值測試
- **名稱**: 剛好低於 20% 閾值的測試
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證 19.9% 繁中時檢測為 en

#### API-KW-229-UT: 數字符號處理
- **名稱**: 純數字和符號的語言檢測
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 數字符號內容預設為 en

#### API-KW-230-UT: 混合內容數字符號
- **名稱**: 混合內容中的數字符號處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 正確計算語言比例時排除數字符號

#### API-KW-231-UT: 服務清理測試
- **名稱**: 檢測服務資源清理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 確保服務正確清理資源

#### API-KW-232-UT: 初始化和常數驗證
- **名稱**: 檢測器初始化和常數設定
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證檢測器正確初始化

#### API-KW-233-UT: 多次檢測一致性
- **名稱**: 多次檢測結果一致性
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 相同輸入多次檢測結果一致

#### API-KW-234-UT: 簡中語言組成分析
- **名稱**: 包含簡體中文的語言組成分析
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 正確識別簡體中文比例

#### API-KW-235-UT: 混合語言組成分析
- **名稱**: 混合語言的詳細組成分析
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 準確分析各語言成分比例

#### API-KW-236-UT: 空白文字處理
- **名稱**: 純空白字元的處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 正確處理空白字元

### 3.4 Prompt 管理器測試 (24個單元測試)

#### API-KW-241-UT: 英文 prompt 選擇驗證
- **名稱**: 檢測為英文時選擇英文 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 確認 prompt_manager.get_prompt("en", "latest") 被呼叫

#### API-KW-242-UT: 繁中 prompt 選擇驗證
- **名稱**: 檢測為繁中時選擇繁中 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: prompt_manager.get_prompt("zh-TW", "latest") 被呼叫

#### API-KW-243-UT: 混合語言 prompt 選擇
- **名稱**: 混合語言時根據閾值選擇正確 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 繁中比例 > 20% 時選擇 zh-TW prompt

#### API-KW-244-UT: 不支援語言錯誤處理
- **名稱**: prompt 管理器處理不支援語言
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: PromptNotAvailableError

#### API-KW-245-UT: 明確語言參數覆蓋
- **名稱**: language 參數可覆蓋自動檢測
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 使用指定語言 prompt，不呼叫檢測服務

#### API-KW-246-UT: 無效語言參數
- **名稱**: 無效語言參數的錯誤處理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: ValueError

#### API-KW-247-UT: Prompt 格式驗證
- **名稱**: prompt 格式正確性
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: prompt 包含必要的 placeholders 和結構

#### API-KW-248-UT: 多重 placeholder 格式
- **名稱**: prompt 多重 placeholder 驗證
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 支援多個 placeholder 的格式化

#### API-KW-249-UT: 快取功能測試
- **名稱**: prompt 快取機制
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證快取正確運作

#### API-KW-250-UT: 可用版本查詢
- **名稱**: 獲取可用 prompt 版本
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 正確返回所有可用版本

#### API-KW-251-UT: 最新版本查詢
- **名稱**: 獲取最新 prompt 版本
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 正確識別最新版本

#### API-KW-252-UT: Prompt 元資料查詢
- **名稱**: prompt 元資料檢索
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 返回完整的 prompt 元資料

#### API-KW-253-UT: 支援組合查詢
- **名稱**: 獲取所有支援的語言版本組合
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 列出所有有效的語言版本組合

#### API-KW-254-UT: 快取統計
- **名稱**: prompt 快取統計資訊
- **優先級**: P2
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 提供快取命中率等統計

#### API-KW-255-UT: 混合內容超閾值 prompt
- **名稱**: 混合內容超過閾值時的 prompt 選擇
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: > 20% 繁中時選擇 zh-TW

#### API-KW-256-UT: 混合內容低閾值 prompt
- **名稱**: 混合內容低於閾值時的 prompt 選擇
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: < 20% 繁中時選擇 en

#### API-KW-257-UT: 20%閾值邊界處理
- **名稱**: 正好 20% 閾值的 prompt 選擇
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: = 20% 時選擇 zh-TW

#### API-KW-258-UT: 版本不存在降級
- **名稱**: 請求版本不存在時的降級處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 自動降級到最新可用版本

#### API-KW-259-UT: Prompt 管理器初始化
- **名稱**: prompt 管理器初始化驗證
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 正確載入所有 prompt 設定

#### API-KW-260-UT: 資源清理
- **名稱**: prompt 管理器資源清理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 確保資源正確釋放

#### API-KW-261-UT: 語言覆蓋工作流程
- **名稱**: 完整的語言覆蓋工作流程
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 端到端驗證語言覆蓋邏輯

#### API-KW-262-UT: 不支援語言鏈
- **名稱**: 不支援語言的錯誤傳遞鏈
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 錯誤正確傳遞到上層

#### API-KW-263-UT: JD 格式化測試
- **名稱**: 使用 JD 格式化 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: JD 正確插入 prompt 模板

#### API-KW-264-UT: Prompt 模板邊界案例
- **名稱**: prompt 模板驗證邊界案例
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 處理特殊字元和邊界情況

### 3.5 關鍵字提取擴展測試 (16個單元測試) - test_keyword_extraction_extended.py

#### API-KW-401-UT: 英文檢測選擇英文 prompt
- **名稱**: 驗證英文檢測後選擇正確的英文 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 確保英文 JD 使用英文 prompt
- **測試文件**: test_keyword_extraction_extended.py::test_english_detection_selects_english_prompt

#### API-KW-402-UT: 中文檢測選擇中文 prompt
- **名稱**: 驗證中文檢測後選擇正確的中文 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 確保中文 JD 使用中文 prompt
- **測試文件**: test_keyword_extraction_extended.py::test_chinese_detection_selects_chinese_prompt

#### API-KW-403-UT: 混合語言 prompt 選擇
- **名稱**: 混合語言的 prompt 選擇邏輯
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證混合語言時的 prompt 選擇
- **測試文件**: test_keyword_extraction_extended.py::test_mixed_language_prompt_selection

#### API-KW-404-UT: 不支援語言錯誤
- **名稱**: 不支援語言引發錯誤
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證不支援語言正確拋出錯誤
- **測試文件**: test_keyword_extraction_extended.py::test_unsupported_language_raises_error

#### API-KW-405-UT: 明確語言參數跳過檢測
- **名稱**: 明確指定語言參數時跳過自動檢測
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證 language 參數覆蓋自動檢測
- **測試文件**: test_keyword_extraction_extended.py::test_explicit_language_bypasses_detection

#### API-KW-406-UT: 無效明確語言錯誤
- **名稱**: 無效的明確語言參數引發錯誤
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證無效語言參數的錯誤處理
- **測試文件**: test_keyword_extraction_extended.py::test_invalid_explicit_language_raises_error

#### API-KW-407-UT: Prompt 管理器初始化
- **名稱**: 測試 prompt 管理器初始化
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證 prompt 管理器正確初始化
- **測試文件**: test_keyword_extraction_extended.py::test_prompt_manager_initialization

#### API-KW-408-UT: 獲取英文 prompt
- **名稱**: 測試獲取英文 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證能正確獲取英文 prompt
- **測試文件**: test_keyword_extraction_extended.py::test_get_english_prompt

#### API-KW-409-UT: 獲取中文 prompt
- **名稱**: 測試獲取中文 prompt
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證能正確獲取中文 prompt
- **測試文件**: test_keyword_extraction_extended.py::test_get_chinese_prompt

#### API-KW-410-UT: 格式化 prompt
- **名稱**: 測試 prompt 格式化功能
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證 JD 正確插入 prompt 模板
- **測試文件**: test_keyword_extraction_extended.py::test_format_prompt_with_job_description

#### API-KW-411-UT: 不支援語言 prompt 錯誤
- **名稱**: 獲取不支援語言的 prompt 引發錯誤
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證不支援語言的錯誤處理
- **測試文件**: test_keyword_extraction_extended.py::test_get_unsupported_language_raises_error

#### API-KW-412-UT: 空 JD 處理
- **名稱**: 空職缺描述處理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證空 JD 的錯誤處理
- **測試文件**: test_keyword_extraction_extended.py::test_empty_job_description_handling

#### API-KW-413-UT: 極短 JD 處理
- **名稱**: 極短職缺描述處理
- **優先級**: P0
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證極短 JD 的處理
- **測試文件**: test_keyword_extraction_extended.py::test_very_short_job_description

#### API-KW-414-UT: 純數字符號處理
- **名稱**: 純數字和符號的處理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證純數字符號內容的處理
- **測試文件**: test_keyword_extraction_extended.py::test_numbers_and_symbols_only

#### API-KW-415-UT: 成功時服務清理
- **名稱**: 成功執行後的服務清理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證成功後正確清理服務資源
- **測試文件**: test_keyword_extraction_extended.py::test_service_cleanup_on_success

#### API-KW-416-UT: 錯誤時服務清理
- **名稱**: 錯誤發生時的服務清理
- **優先級**: P1
- **類型**: 單元測試
- **需求編號**: REQ-002
- **測試目標**: 驗證錯誤時正確清理服務資源
- **測試文件**: test_keyword_extraction_extended.py::test_service_cleanup_on_error

### 3.6 語言檢測整合測試 (15個)

#### API-KW-301-IT: 英文 JD 使用英文 prompt
- **名稱**: 端到端驗證英文職缺使用英文 prompt
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: detected_language="en", prompt_version 包含 "en"

#### API-KW-302-IT: 繁中 JD 使用繁中 prompt
- **名稱**: 端到端驗證繁中職缺使用繁中 prompt
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: detected_language="zh-TW", prompt_version 包含 "zh-TW"

#### API-KW-303-IT: 混合語言（>20%繁中）
- **名稱**: 混合語言正確選擇 prompt
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: detected_language="zh-TW", 使用繁中 prompt

#### API-KW-304-IT: 混合語言（<20%繁中）
- **名稱**: 混合語言低於閾值時使用英文 prompt
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: detected_language="en", prompt_version 包含 "en"

#### API-KW-305-IT: 拒絕簡體中文
- **名稱**: API 正確回傳 400 錯誤（簡中）
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: HTTP 400, error.code="UNSUPPORTED_LANGUAGE"

#### API-KW-306-IT: 拒絕日文
- **名稱**: API 正確拒絕日文 JD
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: HTTP 400, error.code="UNSUPPORTED_LANGUAGE"

#### API-KW-307-IT: 拒絕韓文
- **名稱**: API 正確拒絕韓文 JD
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: HTTP 400, error.code="UNSUPPORTED_LANGUAGE"

#### API-KW-308-IT: 拒絕混合不支援語言
- **名稱**: API 正確拒絕混合不支援語言
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: HTTP 400 + UNSUPPORTED_LANGUAGE

#### API-KW-309-IT: 語言參數覆蓋測試
- **名稱**: 明確指定 language 參數時的 API 行為
- **優先級**: P1
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: 使用指定的語言 prompt，不進行自動檢測

#### API-KW-310-IT: 錯誤回應格式驗證
- **名稱**: 不支援語言時的錯誤回應結構
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: 驗證錯誤回應包含完整結構

#### API-KW-311-IT: 20%閾值整合測試
- **名稱**: 正好 20% 繁中的整合測試
- **優先級**: P1
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: 邊界條件的端到端驗證

#### API-KW-312-IT: 最小長度驗證整合
- **名稱**: JD 最小長度要求的整合測試
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: < 200 字元返回驗證錯誤

#### API-KW-313-IT: 語言檢測元資料回應
- **名稱**: API 回應包含語言檢測元資料
- **優先級**: P1
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: 回應包含 detected_language 等元資料

#### API-KW-314-IT: 不支援語言詳細錯誤
- **名稱**: 不支援語言的完整錯誤詳情
- **優先級**: P0
- **類型**: 整合測試
- **需求編號**: REQ-002
- **測試目標**: 錯誤包含語言組成分析詳情

#### API-KW-315-PT: 關鍵字提取效能
- **名稱**: 關鍵字提取回應時間測試
- **優先級**: P1
- **類型**: 效能測試
- **需求編號**: REQ-002
- **測試目標**: 驗證回應時間 < 3秒
## 4. 測試追溯性設計

### 4.1 需求對應表
| 需求編號 | 需求描述 | 相關測試案例 | 測試數量 |
|----------|----------|-------------|----------|
| REQ-001 | 系統健康監控 | API-HLT-001~010 | 10個 |
| REQ-002 | JD 關鍵字提取 | API-KW-101~111, 211~236, 241~264, 301~315, 401~416 | 92個 |
| REQ-003 | 履歷匹配指數 | API-IDX-201~205 (預留) | 0個 |
| REQ-004 | 差距分析 | API-GAP-301~305 (預留) | 0個 |

### 4.2 覆蓋率矩陣
| 功能模組 | 單元測試 | 整合測試 | 效能測試 | 安全測試 | 總計 |
|----------|----------|----------|----------|----------|------|
| 健康檢查 | ✅ 9個 | ✅ 1個 | - | - | 10個 |
| 關鍵字提取 | ✅ 76個 | ✅ 15個 | ✅ 1個 | ⏳ | 92個 |
| 匹配指數 | ⏳ | ⏳ | ⏳ | ⏳ | 0個 |
| 差距分析 | ⏳ | ⏳ | ⏳ | ⏳ | 0個 |
| **總計** | **85個** | **16個** | **1個** | **0個** | **102個** |

**圖例**: ✅ 已完成 | ⏳ 計劃中 | - 不適用

## 5. 測試資料規範

### 5.1 資料分類

測試資料目錄結構：

```
fixtures/
├── jd/                 # 職缺描述範例
│   ├── valid/         # 有效輸入
│   ├── invalid/       # 無效輸入
│   └── edge_cases/    # 邊界案例
├── resumes/           # 履歷範例
├── responses/         # API 回應範例
└── configs/           # 測試配置
```

### 5.2 命名規範
- 有效資料: `valid_[描述]_[序號].json`
- 無效資料: `invalid_[錯誤類型]_[序號].json`
- 邊界案例: `edge_[案例類型]_[序號].json`

## 6. 測試執行規範

### 6.1 執行指令

```bash
# Level 0: Prompt 驗證
./scripts/run_level0_tests.sh

# Level 1: 程式碼品質
./run_level1_tests.sh

# Level 2: 單元測試
python run_level2_tests.py

# 特定模組測試
pytest tests/unit/test_keyword_extraction.py -v

# 指定測試案例
pytest tests/unit/test_keyword_extraction.py::test_API_KW_101_UT -v
```

### 6.2 測試標記 (Markers)

```python
@pytest.mark.unit          # 單元測試
@pytest.mark.integration   # 整合測試
@pytest.mark.performance   # 效能測試
@pytest.mark.security      # 安全測試
@pytest.mark.p0           # P0 優先級
@pytest.mark.p1           # P1 優先級
@pytest.mark.p2           # P2 優先級
```

## 7. 擴充指南

### 7.1 新增測試案例
1. 選擇適當的模組代碼
2. 使用下一個可用序號
3. 遵循命名規範
4. 更新追溯矩陣
5. 實作測試程式碼

### 7.2 新增功能模組
1. 在編號系統中定義新模組代碼
2. 分配序號範圍 (預留充足空間)
3. 建立對應的測試檔案
4. 更新測試矩陣

## 8. 最佳實踐

### 8.1 測試設計原則
- **獨立性**: 每個測試可獨立執行
- **重複性**: 多次執行結果一致
- **快速性**: 單元測試 < 100ms
- **清晰性**: 測試名稱即文檔

### 8.2 程式碼規範

```python
# 測試函數命名
def test_[測試編號]_[簡短描述]():
    """測試案例: [編號] - [完整描述]"""
    # Arrange
    # Act  
    # Assert

# 測試類別組織
class Test[模組名稱]:
    """[模組]相關測試"""
    
    @pytest.fixture
    def setup_data(self):
        """測試資料準備"""
        pass
```

---

**注意事項**:
- 測試編號一旦分配不可更改
- 刪除的測試案例編號不可重用
- 定期審查並更新測試規格

## 9. 測試案例統計摘要

### 9.1 總體統計
- **總測試案例數**: 102個（注意：編號 API-KW-237 到 API-KW-240 為空）
- **已實作模組**: 2個（健康檢查、關鍵字提取）
- **待開發模組**: 5個以上

### 9.2 詳細分布
| 模組 | 單元測試 | 整合測試 | 效能測試 | 總計 |
|------|----------|----------|----------|------|
| 健康檢查 (HLT) | 9 | 1 | 0 | 10 |
| 關鍵字提取基礎 (KW 101-111) | 10 | 1 | 0 | 11 |
| 語言檢測 (KW 211-236) | 26 | 0 | 0 | 26 |
| Prompt管理 (KW 241-264) | 24 | 0 | 0 | 24 |
| 語言檢測整合 (KW 301-314) | 0 | 14 | 0 | 14 |
| 關鍵字提取擴展 (KW 401-416) | 16 | 0 | 0 | 16 |
| 效能測試 (KW 315) | 0 | 0 | 1 | 1 |
| **總計** | **85** | **16** | **1** | **102** |

### 9.3 編號系統說明
**重要提醒**: 
- TEST_MATRIX.md 使用編號格式：`TEST-HC-XXX`, `TEST-KW-XXX`
- TEST_SPEC.md 使用編號格式：`API-HLT-XXX`, `API-KW-XXX`
- 兩份文件的編號系統需要統一，建議採用 TEST_SPEC.md 的格式作為標準

### 9.4 與 TEST_MATRIX.md 的差異
根據 TEST_MATRIX.md 記錄：
- 健康檢查：9個測試案例
- 關鍵字提取：33個單元測試 + 10個整合測試 = 43個
- **TEST_MATRIX.md 總計：52個測試案例**

本文檔記錄：
- 健康檢查：10個（9個單元測試 + 1個整合測試）
- 關鍵字提取：92個（76個單元測試 + 15個整合測試 + 1個效能測試）
- **TEST_SPEC.md 總計：102個測試案例**

差異原因：
1. 本文檔將語言檢測和Prompt管理器的測試案例進行了更細緻的分類和編號
2. 注意編號 API-KW-237 到 API-KW-240 為空，沒有對應的測試案例
3. 新增了 test_keyword_extraction_extended.py 的 16 個測試案例（API-KW-401~416）

### 9.5 效能測試文件名稱說明

**重要說明**：效能測試存在兩個不同的文件：

| 文件名稱 | 位置 | 狀態 | 說明 |
|----------|------|------|------|
| test_keyword_extraction_performance.py | test/performance/ | 存在但未被執行 | 對應 TEST_SPEC.md 的 API-KW-315-PT |
| test_keyword_extraction_performance_simple.py | test/performance/ | 被 run_complete_test_suite.sh 執行 | 實際執行的效能測試 |

**建議**：
- 確認哪個文件是正確的效能測試實作
- 統一文件名稱或在文檔中明確說明差異
- 更新 run_complete_test_suite.sh 使用正確的文件