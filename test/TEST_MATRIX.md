# Azure Container API 測試追溯矩陣

## 文檔資訊
- **版本**: 1.0.0
- **建立日期**: 2025-07-30
- **最後更新**: 2025-07-30
- **維護者**: 測試團隊
- **自動更新**: 每週五 (透過 CI/CD)

## 變更歷史
| 版本 | 日期 | 變更內容 | 修改者 |
|------|------|----------|--------|
| 1.0.0 | 2025-07-30 | 初始版本 | 測試團隊 |

## 1. API 端點測試覆蓋矩陣

### 1.1 現有端點 (2/2 已實作)

| API 端點 | 方法 | 單元測試 | 整合測試 | 效能測試 | 安全測試 | 覆蓋率 | 最後測試 |
|----------|------|----------|----------|----------|----------|---------|----------|
| `/health` | GET | ✅ 9/9 | ✅ 1/1 | - | - | 100% | 2025-07-30 |
| `/api/v1/extract-jd-keywords` | POST | ✅ 10/10 | ✅ 2/2 | ✅ 1/1 | ⏳ | 95% | 2025-07-30 |

### 1.2 計劃端點 (0/20+ 已實作)

| API 端點 | 方法 | 單元測試 | 整合測試 | 效能測試 | 安全測試 | 狀態 | 預計日期 |
|----------|------|----------|----------|----------|----------|------|----------|
| `/api/v1/index-calculation` | POST | ⏳ 0/5 | ⏳ 0/2 | ⏳ 0/1 | ⏳ | 規劃中 | 2025-08-15 |
| `/api/v1/index-cal-and-gap-analysis` | POST | ⏳ 0/6 | ⏳ 0/2 | ⏳ 0/1 | ⏳ | 規劃中 | 2025-08-15 |
| `/api/v1/format-resume` | POST | ⏳ 0/5 | ⏳ 0/2 | ⏳ 0/1 | ⏳ | 規劃中 | 2025-08-30 |
| `/api/v1/tailor-resume` | POST | ⏳ 0/6 | ⏳ 0/2 | ⏳ 0/1 | ⏳ | 規劃中 | 2025-08-30 |
| `/api/v1/courses/search` | POST | ⏳ 0/5 | ⏳ 0/2 | ⏳ 0/1 | ⏳ | 規劃中 | 2025-09-15 |
| `/api/v1/auth/login` | POST | ⏳ 0/4 | ⏳ 0/2 | ⏳ 0/1 | ⏳ 0/2 | 待開發 | TBD |
| `/api/v1/auth/refresh` | POST | ⏳ 0/3 | ⏳ 0/1 | - | ⏳ 0/1 | 待開發 | TBD |
| `/api/v1/monitoring/stats` | GET | ⏳ 0/3 | ⏳ 0/1 | - | - | 待開發 | TBD |
| `/api/v1/debug/storage-info` | GET | ⏳ 0/2 | - | - | - | 待開發 | TBD |
| `/api/v1/debug/errors` | GET | ⏳ 0/2 | - | - | - | 待開發 | TBD |

**圖例**: 
- ✅ 已完成 (數字表示: 完成/總計)
- ⏳ 計劃中 (數字表示: 完成/預計)
- ❌ 失敗
- 🔄 執行中
- `-` 不適用

## 2. 測試類型分布統計

### 2.1 現有測試統計
| 測試類型 | 已實作 | 計劃中 | 總計 | 完成率 |
|----------|--------|--------|------|---------|
| 單元測試 | 19 | 38 | 57 | 33.3% |
| 整合測試 | 3 | 15 | 18 | 16.7% |
| 效能測試 | 1 | 8 | 9 | 11.1% |
| 安全測試 | 0 | 4 | 4 | 0% |
| **總計** | **23** | **65** | **88** | **26.1%** |

### 2.2 優先級分布
| 優先級 | P0 (關鍵) | P1 (重要) | P2 (次要) | 總計 |
|--------|-----------|-----------|-----------|------|
| 已完成 | 19 | 4 | 0 | 23 |
| 計劃中 | 25 | 30 | 10 | 65 |
| **總計** | **44** | **34** | **10** | **88** |

## 3. 模組測試覆蓋率

| 模組名稱 | 程式碼行數 | 測試覆蓋率 | 分支覆蓋率 | 關鍵路徑 | 風險等級 |
|----------|-----------|------------|-----------|----------|----------|
| health | 45 | 100% | 100% | ✅ | 低 |
| keyword_extraction | 320 | 95% | 88% | ✅ | 低 |
| index_calculation | 280 | 0% | 0% | ❌ | 高 |
| gap_analysis | 450 | 0% | 0% | ❌ | 高 |
| resume_format | 380 | 0% | 0% | ❌ | 中 |
| resume_tailor | 520 | 0% | 0% | ❌ | 高 |
| course_search | 290 | 0% | 0% | ❌ | 中 |
| auth | 180 | 0% | 0% | ❌ | 高 |
| monitoring | 150 | 0% | 0% | ❌ | 低 |
| **總計** | **2,615** | **18.2%** | **16.5%** | 2/9 | - |

## 4. 測試執行時程表

### 4.1 每日執行
| 時間 | 測試類型 | 範圍 | 預計耗時 |
|------|----------|------|----------|
| 02:00 | 單元測試 | 全部 | 3 分鐘 |
| 06:00 | 整合測試 | P0 功能 | 5 分鐘 |
| 14:00 | 健康檢查 | 生產環境 | 30 秒 |
| 22:00 | 效能測試 | 核心 API | 10 分鐘 |

### 4.2 觸發式執行
| 觸發事件 | 測試範圍 | 預計耗時 | 阻擋部署 |
|----------|----------|----------|----------|
| 程式碼提交 | 相關單元測試 | 1 分鐘 | 否 |
| Pull Request | Level 0-2 | 5 分鐘 | 是 |
| 合併到 main | Level 0-3 | 10 分鐘 | 是 |
| 部署前 | 完整測試 | 20 分鐘 | 是 |

## 5. 測試環境矩陣

| 環境 | Python | FastAPI | 資料庫 | 快取 | 用途 |
|------|--------|---------|--------|------|------|
| 本地開發 | 3.12 | 0.115.6 | SQLite | Memory | 開發測試 |
| CI/CD | 3.12 | 0.115.6 | PostgreSQL 16 | Redis | 自動化測試 |
| Staging | 3.12 | 0.115.6 | PostgreSQL 16 | Redis | 預生產測試 |
| 生產 | 3.12 | 0.115.6 | PostgreSQL 16 | Redis | 監控only |

## 6. 測試工具版本

| 工具 | 版本 | 用途 | 最後更新 |
|------|------|------|----------|
| pytest | 8.3.5 | 測試框架 | 2025-07-30 |
| pytest-cov | 6.0.0 | 覆蓋率分析 | 2025-07-30 |
| pytest-asyncio | 0.25.2 | 非同步測試 | 2025-07-30 |
| httpx | 0.28.1 | API 測試 | 2025-07-30 |
| ruff | 0.9.2 | 程式碼品質 | 2025-07-30 |
| mypy | 1.14.1 | 類型檢查 | 2025-07-30 |
| locust | 2.34.1 | 效能測試 | 2025-07-30 |
| responses | 0.26.0 | Mock HTTP | 2025-07-30 |

## 7. 關鍵指標追蹤

### 7.1 測試健康度指標
| 指標 | 目標值 | 當前值 | 狀態 | 趨勢 |
|------|--------|--------|------|------|
| 整體覆蓋率 | > 80% | 18.2% | ❌ | ↗️ |
| P0 測試通過率 | 100% | 100% | ✅ | → |
| 測試執行時間 | < 5分鐘 | 3.5分鐘 | ✅ | ↘️ |
| 測試穩定性 | > 99% | 98.5% | ⚠️ | ↗️ |
| 新功能測試覆蓋 | 100% | 100% | ✅ | → |

### 7.2 缺陷指標
| 指標 | 本月 | 上月 | 變化 | 目標 |
|------|------|------|------|------|
| 發現缺陷數 | 12 | 8 | +50% | - |
| 生產缺陷數 | 0 | 1 | -100% | 0 |
| 平均修復時間 | 2.5天 | 3.2天 | -22% | < 2天 |
| 回歸缺陷率 | 0% | 5% | -100% | < 2% |

## 8. 風險評估矩陣

| 功能模組 | 複雜度 | 變更頻率 | 業務影響 | 測試優先級 | 風險分數 |
|----------|--------|-----------|-----------|------------|----------|
| 健康檢查 | 低 | 低 | 高 | P0 | 3 |
| 關鍵字提取 | 中 | 中 | 高 | P0 | 6 |
| 匹配指數 | 高 | 高 | 高 | P0 | 9 |
| 差距分析 | 高 | 中 | 高 | P0 | 8 |
| 履歷格式化 | 中 | 低 | 中 | P1 | 4 |
| 履歷客製化 | 高 | 高 | 高 | P0 | 9 |
| 課程搜尋 | 中 | 低 | 低 | P2 | 3 |
| 認證授權 | 中 | 低 | 高 | P0 | 5 |

**風險分數計算**: 複雜度(1-3) × 變更頻率(1-3) × 業務影響(1-3) / 3

## 9. 測試債務追蹤

### 9.1 技術債務清單
| ID | 債務描述 | 影響範圍 | 優先級 | 預計工時 | 負責人 |
|----|----------|----------|--------|----------|--------|
| TD-001 | 缺少整合測試 Mock 框架 | 所有整合測試 | P0 | 16h | TBD |
| TD-002 | 效能測試基準未建立 | 效能測試 | P1 | 8h | TBD |
| TD-003 | 測試資料管理混亂 | 全部測試 | P1 | 12h | TBD |
| TD-004 | 缺少 E2E 測試框架 | 端到端測試 | P2 | 24h | TBD |

### 9.2 改進計畫
- **短期 (1個月)**: 完成 P0 功能的單元測試
- **中期 (3個月)**: 建立完整測試框架和 CI/CD
- **長期 (6個月)**: 達到 80% 覆蓋率目標

## 10. 測試案例細項對照

### 10.1 健康檢查測試細項 (9個)
| 測試編號 | 測試名稱 | 類型 | 狀態 |
|----------|----------|------|------|
| TEST-HC-101-UNIT | 成功的健康檢查回應 | 單元 | ✅ |
| TEST-HC-102-UNIT | 回應格式驗證 | 單元 | ✅ |
| TEST-HC-103-UNIT | 版本資訊正確性 | 單元 | ✅ |
| TEST-HC-104-UNIT | 總是回傳健康狀態 | 單元 | ✅ |
| TEST-HC-105-UNIT | 時間戳記格式驗證 | 單元 | ✅ |
| TEST-HC-106-UNIT | HTTP 方法驗證 (非 GET 回傳 405) | 單元 | ✅ |
| TEST-HC-107-UNIT | 不需要認證 | 單元 | ✅ |
| TEST-HC-108-UNIT | CORS headers 存在 | 單元 | ✅ |
| TEST-HC-109-UNIT | Mock 時間戳記測試 | 單元 | ✅ |

### 10.2 關鍵字提取測試細項 (10個)
| 測試編號 | 測試名稱 | 類型 | 狀態 |
|----------|----------|------|------|
| TEST-KW-201-UNIT | 成功的關鍵字提取 | 單元 | ✅ |
| TEST-KW-202-UNIT | 驗證錯誤處理 (描述過短) | 單元 | ✅ |
| TEST-KW-203-UNIT | 無效的 max_keywords 參數 | 單元 | ✅ |
| TEST-KW-204-UNIT | Azure OpenAI 速率限制錯誤處理 | 單元 | ✅ |
| TEST-KW-205-UNIT | 逾時錯誤處理 | 單元 | ✅ |
| TEST-KW-206-UNIT | 品質警告偵測 | 單元 | ✅ |
| TEST-KW-207-UNIT | 回應格式驗證 | 單元 | ✅ |
| TEST-KW-208-UNIT | 中文職缺描述支援 | 單元 | ✅ |
| TEST-KW-209-UNIT | 錯誤時的服務清理 | 單元 | ✅ |
| TEST-KW-210-UNIT | 長職缺描述的邊界案例 | 單元 | ✅ |

## 11. 快速參考

### 10.1 測試執行命令
```bash
# 查看當前覆蓋率
pytest --cov=src --cov-report=html

# 執行特定模組測試
pytest tests/unit/test_keyword_extraction.py -v

# 執行特定優先級測試
pytest -m p0 -v

# 生成測試報告
pytest --junit-xml=reports/junit.xml --html=reports/report.html
```

### 10.2 新增測試檢查清單
- [ ] 測試案例編號已分配
- [ ] 測試規格已更新
- [ ] 追溯矩陣已更新
- [ ] 測試資料已準備
- [ ] CI/CD 配置已更新
- [ ] 文檔已同步

---

**自動生成說明**:
- 覆蓋率數據: 每日 02:30 自動更新
- 執行統計: 即時更新
- 風險評估: 每週審查更新
- 完整報告: `/test/reports/` 目錄

**最後自動更新時間**: 2025-07-30 14:30:00 UTC