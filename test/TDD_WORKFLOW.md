# TDD é–‹ç™¼å·¥ä½œæµç¨‹

## ğŸ¯ æ ¸å¿ƒç†å¿µ
ã€Œå…ˆå¯«æ¸¬è©¦è¦æ ¼ï¼Œå†å¯«ç¨‹å¼ç¢¼ã€- ç¢ºä¿æ¯å€‹åŠŸèƒ½éƒ½æœ‰æ˜ç¢ºçš„é©—æ”¶æ¨™æº–

## ğŸ”„ TDD æµç¨‹åœ–

```mermaid
graph TD
    A[æ–°éœ€æ±‚: æ–°å¢ API åŠŸèƒ½] --> B[æŸ¥çœ‹ TEST_STRATEGY.md<br/>ç¢ºèªå„ªå…ˆç´šå’Œæ¸¬è©¦é¡å‹]
    B --> C[åœ¨ TEST_SPEC.md<br/>æ–°å¢æ¸¬è©¦æ¡ˆä¾‹è¦æ ¼]
    C --> D[æ›´æ–° TEST_MATRIX.md<br/>æ¨™è¨˜ç‚º ğŸ”„ é–‹ç™¼ä¸­]
    D --> E[æ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼<br/>é æœŸå¤±æ•— ğŸ”´]
    E --> F{åŸ·è¡Œæ¸¬è©¦}
    F -->|å¤±æ•—| G[å¯¦ä½œæœ€å°åŠŸèƒ½<br/>è®“æ¸¬è©¦é€šé]
    G --> H{åŸ·è¡Œæ¸¬è©¦}
    H -->|é€šé ğŸŸ¢| I[é‡æ§‹ç¨‹å¼ç¢¼]
    I --> J[åŸ·è¡Œæ‰€æœ‰ç›¸é—œæ¸¬è©¦]
    J -->|å…¨éƒ¨é€šé| K[æ›´æ–° TEST_MATRIX.md<br/>æ¨™è¨˜å®Œæˆçš„æ¸¬è©¦ âœ…]
    J -->|æœ‰å¤±æ•—| I
    K --> L{é‚„æœ‰æ›´å¤š<br/>æ¸¬è©¦æ¡ˆä¾‹?}
    L -->|æ˜¯| E
    L -->|å¦| M[åŠŸèƒ½é–‹ç™¼å®Œæˆ]
```

## ğŸ“‹ æ¨™æº– TDD æµç¨‹

### Step 1: éœ€æ±‚åˆ†æèˆ‡æ¸¬è©¦è¦åŠƒ
ç•¶è¦æ–°å¢åŠŸèƒ½ï¼ˆå¦‚ index-calculationï¼‰æ™‚ï¼š

```bash
# 1. ç¢ºèªéœ€æ±‚
- æŸ¥çœ‹ API è¦æ ¼æ–‡ä»¶
- äº†è§£è¼¸å…¥/è¼¸å‡ºæ ¼å¼
- ç¢ºèªéŒ¯èª¤è™•ç†éœ€æ±‚

# 2. æŸ¥çœ‹æ¸¬è©¦ç­–ç•¥
- åƒè€ƒ TEST_STRATEGY.md ç¢ºèªå„ªå…ˆç´š
- æ±ºå®šéœ€è¦å“ªäº›é¡å‹çš„æ¸¬è©¦ï¼ˆå–®å…ƒ/æ•´åˆ/æ•ˆèƒ½ï¼‰
```

### Step 2: å»ºç«‹æ¸¬è©¦è¦æ ¼
```bash
# 1. åœ¨ TEST_SPEC.md æ–°å¢æ¸¬è©¦æ¡ˆä¾‹
## ç¯„ä¾‹ï¼šåŒ¹é…æŒ‡æ•¸è¨ˆç®—
#### API-IDX-201-UT: åŸºæœ¬åŒ¹é…è¨ˆç®—
- **åç¨±**: å±¥æ­·èˆ‡è·ç¼ºåŒ¹é…åº¦è¨ˆç®—
- **å„ªå…ˆç´š**: P0
- **é¡å‹**: å–®å…ƒæ¸¬è©¦
- **éœ€æ±‚ç·¨è™Ÿ**: REQ-003
- **æ¸¬è©¦ç›®æ¨™**: é©—è­‰åŒ¹é…æ¼”ç®—æ³•æ­£ç¢ºæ€§

#### API-IDX-202-UT: ç©ºå±¥æ­·è™•ç†
- **åç¨±**: ç©ºå±¥æ­·è¼¸å…¥éŒ¯èª¤è™•ç†
- **å„ªå…ˆç´š**: P0
- **é¡å‹**: å–®å…ƒæ¸¬è©¦
- **éœ€æ±‚ç·¨è™Ÿ**: REQ-003
- **æ¸¬è©¦ç›®æ¨™**: é©—è­‰éŒ¯èª¤è™•ç†é‚è¼¯
```

### Step 3: æ›´æ–°æ¸¬è©¦çŸ©é™£
```bash
# ç·¨è¼¯ TEST_MATRIX.md
| `/api/v1/index-calculation` | POST | â³ 0/5 | â³ 0/2 | â³ 0/1 | â³ | è¦åŠƒä¸­ | 2025-08-15 |
                                         â†“
| `/api/v1/index-calculation` | POST | ğŸ”„ 0/5 | â³ 0/2 | â³ 0/1 | â³ | é–‹ç™¼ä¸­ | 2025-08-15 |
```

### Step 4: æ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼ï¼ˆç´…ç‡ˆï¼‰
```python
# test/unit/test_index_calculation.py
class TestIndexCalculation:
    def test_API_IDX_201_UT_basic_matching(self):
        """æ¸¬è©¦æ¡ˆä¾‹: API-IDX-201-UT - åŸºæœ¬åŒ¹é…è¨ˆç®—"""
        # Arrange
        resume = {"skills": ["Python", "FastAPI"]}
        jd = {"required_skills": ["Python", "FastAPI"]}
        
        # Act
        result = calculate_matching_index(resume, jd)  # æ­¤æ™‚å‡½æ•¸é‚„ä¸å­˜åœ¨
        
        # Assert
        assert result["matching_score"] >= 0.8
        assert result["status"] == "success"
```

### Step 5: å¯¦ä½œåŠŸèƒ½ï¼ˆç¶ ç‡ˆï¼‰
```python
# src/services/index_calculation.py
def calculate_matching_index(resume: dict, jd: dict) -> dict:
    """å¯¦ä½œåŒ¹é…æŒ‡æ•¸è¨ˆç®—"""
    # æœ€å°å¯è¡Œå¯¦ä½œ
    matching_skills = set(resume["skills"]) & set(jd["required_skills"])
    score = len(matching_skills) / len(jd["required_skills"])
    
    return {
        "matching_score": score,
        "status": "success"
    }
```

### Step 6: é‡æ§‹èˆ‡å„ªåŒ–
```python
# æ¸¬è©¦é€šéå¾Œï¼Œé€²è¡Œé‡æ§‹
# - åŠ å…¥æ›´è¤‡é›œçš„æ¼”ç®—æ³•
# - è™•ç†é‚Šç•Œæƒ…æ³
# - å„ªåŒ–æ•ˆèƒ½
```

### Step 7: æ›´æ–°æ¸¬è©¦ç‹€æ…‹
```bash
# æ›´æ–° TEST_MATRIX.md
| `/api/v1/index-calculation` | POST | âœ… 3/5 | â³ 0/2 | â³ 0/1 | â³ | é–‹ç™¼ä¸­ | 2025-08-15 |
```

## ğŸ”„ æŒçºŒæ•´åˆæµç¨‹

### è‡ªå‹•åŒ–æª¢æŸ¥é»
```yaml
# .github/workflows/tdd-check.yml
name: TDD Compliance Check

on: [pull_request]

jobs:
  check-test-first:
    steps:
      - name: æª¢æŸ¥æ¸¬è©¦è¦æ ¼å­˜åœ¨
        run: |
          # ç¢ºèª TEST_SPEC.md æœ‰å°æ‡‰çš„æ¸¬è©¦æ¡ˆä¾‹
          # ç¢ºèª TEST_MATRIX.md å·²æ›´æ–°
          
      - name: æª¢æŸ¥æ¸¬è©¦å…ˆæ–¼å¯¦ä½œ
        run: |
          # ç¢ºèªæ¸¬è©¦æª”æ¡ˆçš„ commit æ™‚é–“æ—©æ–¼å¯¦ä½œ
```

### Git Hooks
```bash
# .git/hooks/pre-commit
#!/bin/bash
# æª¢æŸ¥æ˜¯å¦æœ‰æ–° API ä½†æ²’æœ‰å°æ‡‰æ¸¬è©¦

NEW_ENDPOINTS=$(git diff --staged --name-only | grep -E "api/.*\.py")
if [ ! -z "$NEW_ENDPOINTS" ]; then
  # æª¢æŸ¥ TEST_MATRIX.md æ˜¯å¦æ›´æ–°
  if ! git diff --staged --name-only | grep -q "TEST_MATRIX.md"; then
    echo "âŒ éŒ¯èª¤ï¼šæ–°å¢ API ç«¯é»ä½†æœªæ›´æ–° TEST_MATRIX.md"
    echo "è«‹å…ˆæ›´æ–°æ¸¬è©¦æ–‡æª”å†æäº¤ç¨‹å¼ç¢¼"
    exit 1
  fi
fi
```

## ğŸ“Š å¯¦è¸å»ºè­°

### 1. å°æ­¥å¿«è·‘
- æ¯æ¬¡åªå¯¦ä½œä¸€å€‹å°åŠŸèƒ½
- ç¢ºä¿æ¸¬è©¦å¿«é€ŸåŸ·è¡Œï¼ˆ< 5 ç§’ï¼‰
- é »ç¹æäº¤ï¼ˆæ¯å€‹ç¶ ç‡ˆéƒ½æäº¤ï¼‰

### 2. æ¸¬è©¦å‘½åè¦ç¯„
```python
def test_[æ¸¬è©¦ç·¨è™Ÿ]_[æè¿°]_[æƒ…å¢ƒ]():
    """
    æ¸¬è©¦ç·¨è™Ÿå°æ‡‰ TEST_SPEC.md
    ç¢ºä¿å¯è¿½æº¯æ€§
    """
```

### 3. é–‹ç™¼ç¯€å¥
```
å¯«æ¸¬è©¦(5åˆ†é˜) â†’ å¯«ç¨‹å¼ç¢¼(10åˆ†é˜) â†’ é‡æ§‹(5åˆ†é˜)
= 20åˆ†é˜ä¸€å€‹å¾ªç’°
```

### 4. åœ˜éšŠå”ä½œ
- **é–‹ç™¼è€… A**: å¯«æ¸¬è©¦è¦æ ¼å’Œæ¸¬è©¦ç¨‹å¼ç¢¼
- **é–‹ç™¼è€… B**: å¯¦ä½œåŠŸèƒ½è®“æ¸¬è©¦é€šé
- **ç¨‹å¼ç¢¼å¯©æŸ¥**: ç¢ºèªæ¸¬è©¦è¦†è“‹å®Œæ•´

## âš¡ å¿«é€Ÿåƒè€ƒ

### æ–°åŠŸèƒ½ TDD Checklist
- [ ] éœ€æ±‚æ–‡æª”å·²ç¢ºèª
- [ ] TEST_SPEC.md å·²æ›´æ–°æ¸¬è©¦æ¡ˆä¾‹
- [ ] TEST_MATRIX.md å·²æ–°å¢ç«¯é»
- [ ] æ¸¬è©¦ç¨‹å¼ç¢¼å·²æ’°å¯«ï¼ˆç´…ç‡ˆï¼‰
- [ ] åŠŸèƒ½å¯¦ä½œå®Œæˆï¼ˆç¶ ç‡ˆï¼‰
- [ ] ç¨‹å¼ç¢¼å·²é‡æ§‹
- [ ] TEST_MATRIX.md ç‹€æ…‹å·²æ›´æ–°
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé

### å¸¸ç”¨æŒ‡ä»¤
```bash
# åªåŸ·è¡Œæ–°å¢çš„æ¸¬è©¦
pytest test/unit/test_index_calculation.py::test_API_IDX_201_UT -v

# ç›£æ§æ¨¡å¼ï¼ˆæª”æ¡ˆè®Šæ›´è‡ªå‹•åŸ·è¡Œæ¸¬è©¦ï¼‰
pytest-watch test/unit/test_index_calculation.py

# ç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Š
pytest --cov=src.services.index_calculation test/unit/test_index_calculation.py
```

## ğŸ¯ é æœŸæ•ˆç›Š

1. **å“è³ªä¿è­‰**: æ¯å€‹åŠŸèƒ½éƒ½æœ‰æ¸¬è©¦ä¿è­·
2. **éœ€æ±‚è¿½æº¯**: æ¸¬è©¦å³æ–‡æª”ï¼Œæ¸…æ¥šçŸ¥é“åŠŸèƒ½é æœŸ
3. **å¿«é€Ÿå›é¥‹**: æ”¹å£æ±è¥¿ç«‹å³çŸ¥é“
4. **ä¿¡å¿ƒé‡æ§‹**: æœ‰æ¸¬è©¦ä¿è­·ï¼Œæ•¢æ–¼å„ªåŒ–ç¨‹å¼ç¢¼
5. **åœ˜éšŠå”ä½œ**: æ¸¬è©¦è¦æ ¼æ˜¯æœ€å¥½çš„æºé€šå·¥å…·