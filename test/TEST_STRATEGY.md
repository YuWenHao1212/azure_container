# Azure Container API 測試策略文檔

## 文檔資訊
- **版本**: 1.0.0
- **建立日期**: 2025-07-30
- **最後更新**: 2025-07-30
- **維護者**: 測試團隊

## 變更歷史
| 版本 | 日期 | 變更內容 | 修改者 |
|------|------|----------|--------|
| 1.0.0 | 2025-07-30 | 初始版本 | 測試團隊 |

## 1. 測試方針

### 1.1 核心原則
- **早期測試**: 在開發階段即開始測試，而非等到部署前
- **自動化優先**: 所有重複性測試必須自動化
- **持續整合**: 每次程式碼提交觸發相關測試
- **風險導向**: 優先測試高風險和核心功能

### 1.2 品質目標
- 單元測試覆蓋率: **> 80%**
- API 回應時間: **< 3秒** (95th percentile)
- 零重大缺陷進入生產環境
- 測試執行時間: **< 5分鐘** (完整測試套件)

## 2. 測試範圍

### 2.1 測試層級
1. **Level 0 - Prompt 驗證**
   - YAML 格式檢查
   - Prompt 結構驗證
   - 必要欄位完整性

2. **Level 1 - 程式碼品質**
   - 程式碼風格 (Ruff)
   - 類型檢查 (mypy)
   - 安全掃描

3. **Level 2 - 單元測試**
   - 函數邏輯測試
   - 邊界值測試
   - 異常處理測試

4. **Level 3 - 整合測試**
   - API 端點測試
   - 外部服務模擬
   - 端到端流程

5. **Level 4 - 效能測試**
   - 負載測試
   - 壓力測試
   - 並發測試

### 2.2 功能優先級

#### P0 - 關鍵功能 (必須測試)
- 健康檢查 (/health)
- 身份驗證機制
- 關鍵字提取 (/api/v1/extract-jd-keywords)
- 錯誤處理機制

#### P1 - 重要功能 (應該測試)
- 履歷格式化
- 匹配指數計算
- 差距分析

#### P2 - 次要功能 (可以測試)
- 課程搜尋
- 統計報告
- 除錯端點

## 3. 測試執行策略

### 3.1 觸發時機
- **程式碼提交**: Level 0-2 測試
- **Pull Request**: Level 0-3 測試
- **部署前**: 完整測試套件
- **定期執行**: 每日執行效能測試

### 3.2 環境策略
| 環境 | 測試範圍 | 資料策略 |
|------|----------|----------|
| 本地開發 | Level 0-2 | Mock 資料 |
| CI/CD | Level 0-3 | 測試資料庫 |
| Staging | Level 0-4 | 生產資料副本 |
| 生產 | 健康檢查 | 真實資料 |

## 4. 工具與框架

### 4.1 測試工具
- **單元測試**: pytest
- **API 測試**: pytest + httpx
- **效能測試**: locust
- **程式碼品質**: ruff, mypy
- **覆蓋率**: pytest-cov

### 4.2 Mock 策略
- Azure OpenAI API: 使用 responses 或 pytest-mock
- 資料庫: 使用 in-memory SQLite
- 外部服務: 建立 fixture 模擬回應

## 5. 測試資料管理

### 5.1 資料分類
- **靜態資料**: 存於 fixtures/ 目錄
- **動態資料**: 測試時生成
- **敏感資料**: 不可硬編碼，使用環境變數

### 5.2 資料清理
- 每個測試後自動清理
- 使用 pytest fixture 管理生命週期
- 避免測試間相依性

## 6. 報告與監控

### 6.1 測試報告
- **格式**: JUnit XML + HTML
- **內容**: 覆蓋率、執行時間、失敗詳情
- **儲存**: reports/ 目錄
- **保留期**: 30 天

### 6.2 品質指標
- [ ] 測試覆蓋率趨勢
- [ ] 測試執行時間
- [ ] 失敗率統計
- [ ] 缺陷密度

## 7. 擴充計畫

### 7.1 短期目標 (3個月)
- 完成所有 P0 功能的測試
- 建立 CI/CD pipeline
- 達到 80% 覆蓋率

### 7.2 長期目標 (6個月)
- 完整的效能測試套件
- 自動化安全測試
- 混沌工程測試

## 8. 風險與緩解

| 風險 | 影響 | 緩解策略 |
|------|------|----------|
| 外部 API 不穩定 | 測試失敗 | 建立完整 Mock 機制 |
| 測試執行過慢 | 開發效率降低 | 平行執行、分層測試 |
| 測試資料外洩 | 安全風險 | 加密儲存、定期清理 |

## 9. 審查與更新

- **審查頻率**: 每季度
- **更新觸發**: 重大功能變更、技術架構調整
- **批准流程**: 測試負責人 → 技術主管

---

**注意事項**:
- 本文檔為活文檔，應隨專案演進持續更新
- 所有團隊成員應熟悉並遵循本策略
- 特殊情況需經測試負責人批准